
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>R: Life Modelling Recipes &#8212; Actuaries&#39; Analytical Cookbook</title>
    
  <link href="../_static/css/theme.css" rel="stylesheet">
  <link href="../_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../_static/sphinx-book-theme.d59cb220de22ca1c485ebbdc042f0030.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="R: Life Industry Stats in Tableau and R" href="life_stats.html" />
    <link rel="prev" title="Py: Explainable Models with SHAP" href="py_shap_values.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../_static/actuaries-logo.svg" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Actuaries' Analytical Cookbook</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Introduction to Python
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="about_py.html">
   About Python
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="getting_started.html">
   Setting up Your Python Environment
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="python_by_example.html">
   An Introductory Example
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="learn_more.html">
   Learn More
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="Useful_Python_packages.html">
   Useful Python packages for Data Science
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Introduction to R
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="about_R.html">
   About R
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="getting_started_R.html">
   Setting Up R
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="introductory_R.html">
   Introduction to R
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="intermediate_R.html">
   Next Steps With R
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="top_ten_r_packages.html">
   Useful Packages
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="MLRWP_R_DataTable.html">
   R: data.table for actuaries
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Workflow Management
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="version_control.html">
   Version control
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Regression, Classification and Technical Price
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="DAA_M05_CS1.html">
   Py: Customer Churn Classification
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="multitasking_risk_pricing.html">
   Py/R: Multitasking Risk Pricing Using Deep Learning
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="py_shap_values.html">
   Py: Explainable Models with SHAP
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Life Insurance
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   R: Life Modelling Recipes
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="life_stats.html">
   R: Life Industry Stats in Tableau and R
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="bayesian-applications.html">
   R: Bayesian Applications
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="trees.html">
   R: Decision Tree Applications
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  General Insurance
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="MLRWP_R_GLMs.html">
   R: Reserving with GLMs
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="MLRWP_R_Lasso.html">
   R: Reserving with LASSO
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="MLRWP_R_mlr3.html">
   R: Machine Learning Triangles
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="MLRWP_Py_triangles_example.html">
   Py: Machine Learning Triangles
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Unsupervised Learning
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="DAA_M06_CS1.html">
   Py: Socio-Economic Index Construction
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="DAA_M06_CS2.html">
   Py: Clustering Credit Card Fraud
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="DAA_M06_Ex4.html">
   Py: K-means clustering of COVID dataset
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="DAA_M06_Ex5.html">
   Py: Hierarchical clustering on COVID dataset
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Natural Language Processing
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="R_case_study_word_cloud.html">
   R: Word Cloud Case Study
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="textClassificationEntry.html">
   Py: Text Classification
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="DAA_M05_Ex10.html">
   Py: Decision Tree Classification
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="DAA_M05_Ex18.html">
   Py: Neural Net Classification
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="DAA_M07_CS1.html">
   Py: Classifying review sentiment
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="DAA_M07_CS2.html">
   Py: Customer Sentiment Analysis
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Business Optimization
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="DAA_2021_S2_Tutorial10_exercise_scipy.html">
   Py: Linear Programming
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Image Recognition
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="DAA_M05_CS2.html">
   Py: Image Recognition
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Data Ethics
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="automated_decision.html">
   Automated Decision-Making Systems
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Reference
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="zbibliography.html">
   Bibliography
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Contributing
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="contributing.html">
   Contributing
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/docs/LifeRecipeBook.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
                onclick="printPdf(this)" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/ActuariesInstitute/cookbook"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        
        <a class="edit-button" href="https://github.com/ActuariesInstitute/cookbook/edit/main/cookbook/docs/LifeRecipeBook.ipynb"><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Edit this page"><i class="fas fa-pencil-alt"></i>suggest edit</button></a>
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/ActuariesInstitute/cookbook/main?urlpath=tree/cookbook/docs/LifeRecipeBook.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        <a class="colab-button" href="https://colab.research.google.com/github/ActuariesInstitute/cookbook/blob/main/cookbook/docs/LifeRecipeBook.ipynb"><button type="button" class="btn btn-secondary topbarbtn"
                title="Launch Colab" data-toggle="tooltip" data-placement="left"><img class="colab-button-logo"
                    src="../_static/images/logo_colab.png"
                    alt="Interact on Colab">Colab</button></a>
        
        <button type="button" class="btn btn-secondary topbarbtn"
            onclick="initThebeSBT()" title="Launch Thebe" data-toggle="tooltip" data-placement="left"><i
                class="fas fa-play"></i><span style="margin-left: .4em;">Live Code</span></button>
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show noprint">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   R: Life Modelling Recipes
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#overview">
   Overview
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#background">
     Background
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#libraries">
     Libraries
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#further-reading">
     Further reading
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#data-simulation">
   Data Simulation
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#simulating-policies">
     Simulating policies
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#expected-claim-rate">
     Expected claim rate
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#expected-claims">
     Expected claims
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#grouped-data">
     Grouped data
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#data-exploration">
   Data Exploration
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#data-structure">
     Data structure
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#factors">
     Factors
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#selection-methods">
     Selection methods
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#manipulation-methods">
     Manipulation methods
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#missing-data">
     Missing data
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#review-exposure-data">
     Review exposure data
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#benefit-period-mix">
       Benefit period mix
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#waiting-period-mix">
       Waiting period mix
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#occupation-mix">
       Occupation mix
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#data-format">
     Data format
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#wide-data-format-example">
       Wide data format example
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#visualisation-methods">
     Visualisation methods
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#introduction-to-ggplot">
       Introduction to ggplot
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#layers">
       Layers
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#themes">
       Themes
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#d-visualisations-with-plotly">
       3D visualisations with plotly
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#review-claim-data">
     Review claim data
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#model-selection">
   Model Selection
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#splitting-data">
     Splitting data
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#training-vs-testing-data">
       Training vs testing data
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#class-imbalance">
       Class imbalance
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#regression">
     Regression
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id1">
       Background
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#linear-vs-logistic-regression">
       Linear vs logistic regression
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#logistic-regression-for-claims-incidence">
       Logistic regression for claims incidence
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#linear-regression-for-claims-incidence">
       Linear regression for claims incidence
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#un-grouped-data">
     (Un)grouped data
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#modeled-result-grouped-data">
       Modeled result - grouped data
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#modeled-result-ungrouped-data">
       Modeled result - ungrouped data
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#offsets">
       Offsets
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#actuals-or-ave">
     Actuals or AvE?
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#stepwise-regression">
     Stepwise regression
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#confidence-intervals">
     Confidence intervals
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#predictions">
     Predictions
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#out-of-sample-predictions">
       Out of sample predictions
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#evaluation">
   Evaluation
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#techniques">
     Techniques
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#aic">
       AIC
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#anova">
       Anova
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#likelihood-ratio-test">
       Likelihood ratio test
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#other-tests">
       Other tests
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#residual-checks">
     Residual checks
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#standard-model-plots">
       Standard model plots
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#alternatives">
       Alternatives
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#p-p-plots">
       P-P plots
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id2">
       Other tests
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#confusion-matrix">
     Confusion matrix
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#roc-auc">
     ROC / AUC
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#references">
   References
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>R: Life Modelling Recipes</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   R: Life Modelling Recipes
  </a>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#overview">
   Overview
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#background">
     Background
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#libraries">
     Libraries
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#further-reading">
     Further reading
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#data-simulation">
   Data Simulation
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#simulating-policies">
     Simulating policies
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#expected-claim-rate">
     Expected claim rate
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#expected-claims">
     Expected claims
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#grouped-data">
     Grouped data
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#data-exploration">
   Data Exploration
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#data-structure">
     Data structure
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#factors">
     Factors
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#selection-methods">
     Selection methods
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#manipulation-methods">
     Manipulation methods
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#missing-data">
     Missing data
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#review-exposure-data">
     Review exposure data
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#benefit-period-mix">
       Benefit period mix
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#waiting-period-mix">
       Waiting period mix
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#occupation-mix">
       Occupation mix
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#data-format">
     Data format
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#wide-data-format-example">
       Wide data format example
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#visualisation-methods">
     Visualisation methods
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#introduction-to-ggplot">
       Introduction to ggplot
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#layers">
       Layers
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#themes">
       Themes
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#d-visualisations-with-plotly">
       3D visualisations with plotly
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#review-claim-data">
     Review claim data
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#model-selection">
   Model Selection
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#splitting-data">
     Splitting data
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#training-vs-testing-data">
       Training vs testing data
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#class-imbalance">
       Class imbalance
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#regression">
     Regression
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id1">
       Background
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#linear-vs-logistic-regression">
       Linear vs logistic regression
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#logistic-regression-for-claims-incidence">
       Logistic regression for claims incidence
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#linear-regression-for-claims-incidence">
       Linear regression for claims incidence
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#un-grouped-data">
     (Un)grouped data
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#modeled-result-grouped-data">
       Modeled result - grouped data
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#modeled-result-ungrouped-data">
       Modeled result - ungrouped data
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#offsets">
       Offsets
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#actuals-or-ave">
     Actuals or AvE?
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#stepwise-regression">
     Stepwise regression
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#confidence-intervals">
     Confidence intervals
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#predictions">
     Predictions
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#out-of-sample-predictions">
       Out of sample predictions
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#evaluation">
   Evaluation
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#techniques">
     Techniques
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#aic">
       AIC
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#anova">
       Anova
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#likelihood-ratio-test">
       Likelihood ratio test
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#other-tests">
       Other tests
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#residual-checks">
     Residual checks
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#standard-model-plots">
       Standard model plots
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#alternatives">
       Alternatives
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#p-p-plots">
       P-P plots
      </a>
     </li>
     <li class="toc-h3 nav-item toc-entry">
      <a class="reference internal nav-link" href="#id2">
       Other tests
      </a>
     </li>
    </ul>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#confusion-matrix">
     Confusion matrix
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#roc-auc">
     ROC / AUC
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#references">
   References
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            
              <div>
                
  <div class="tex2jax_ignore mathjax_ignore section" id="r-life-modelling-recipes">
<h1>R: Life Modelling Recipes<a class="headerlink" href="#r-life-modelling-recipes" title="Permalink to this headline">¶</a></h1>
<p>By Pat Reen - originally published on his GitHub site <a class="reference external" href="https://pat-reen.github.io/Modelling-Recipes/">here</a>, which has the <a class="reference external" href="https://github.com/Pat-Reen/Modelling-Recipes/blob/main/RecipeBook.Rmd">original code</a>.</p>
</div>
<div class="tex2jax_ignore mathjax_ignore section" id="overview">
<h1>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h1>
<div class="section" id="background">
<h2>Background<a class="headerlink" href="#background" title="Permalink to this headline">¶</a></h2>
<p>This section sets out a few practical recipes for modelling with (life) insurance data. Insurance events are typically of low probability - these recipes consider some of the limitations of “small data” model fitting (where the observations of interest are sparse) and other topics for insurance like comparisons to standard tables. Themes</p>
<ul class="simple">
<li><p>Common data transforms, summary stats, and simple visualisations</p></li>
<li><p>Regression</p>
<ul>
<li><p>Grouped vs ungrouped data</p></li>
<li><p>Choice of: response distribution, link (and offsets), explanatory variables</p></li>
<li><p>Modelling variance to industry / reference (A/E or A - E)</p></li>
<li><p>Model selection: stepwise regression, likelihood tests, model evaluation</p></li>
<li><p>Predictions, confidence intervals and visualisations</p></li>
</ul>
</li>
</ul>
<p>As with other recipes, the code can be found on <a class="reference external" href="https://github.com/ActuariesInstitute/cookbook/blob/main/cookbook/docs/LifeRecipeBook.Rmd">GitHub</a>.</p>
</div>
<div class="section" id="libraries">
<h2>Libraries<a class="headerlink" href="#libraries" title="Permalink to this headline">¶</a></h2>
<p>A list of packages used in the recipe book.</p>
<div class="cell tag_remove_output docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">library</span><span class="p">(</span><span class="n">rmdformats</span><span class="p">)</span> <span class="c1"># theme for the HTML doc</span>
<span class="nf">library</span><span class="p">(</span><span class="n">bookdown</span><span class="p">)</span>   <span class="c1"># bibliography formatting</span>
<span class="nf">library</span><span class="p">(</span><span class="n">kableExtra</span><span class="p">)</span> <span class="c1"># formatting tables</span>
<span class="nf">library</span><span class="p">(</span><span class="n">scales</span><span class="p">)</span>     <span class="c1"># data formatting  </span>
<span class="nf">library</span><span class="p">(</span><span class="n">dplyr</span><span class="p">)</span>      <span class="c1"># tidyverse: data manipulation</span>
<span class="nf">library</span><span class="p">(</span><span class="n">tidyr</span><span class="p">)</span>      <span class="c1"># tidyverse: tidy messy data</span>
<span class="nf">library</span><span class="p">(</span><span class="n">corrplot</span><span class="p">)</span>   <span class="c1"># correlation matrix visualisation, optional</span>
<span class="nf">library</span><span class="p">(</span><span class="n">ggplot2</span><span class="p">)</span>    <span class="c1"># tidyverse: graphs</span>
<span class="nf">library</span><span class="p">(</span><span class="n">pdp</span><span class="p">)</span>        <span class="c1"># tidyverse: arranging plots</span>
<span class="nf">library</span><span class="p">(</span><span class="n">GGally</span><span class="p">)</span>     <span class="c1"># tidyverse: extension of ggplot2</span>
<span class="nf">library</span><span class="p">(</span><span class="n">ggthemes</span><span class="p">)</span>   <span class="c1"># tidyverse: additional themes for ggplot, optional</span>
<span class="nf">library</span><span class="p">(</span><span class="n">plotly</span><span class="p">)</span>     <span class="c1"># graphs, including 3D </span>
<span class="nf">library</span><span class="p">(</span><span class="n">caret</span><span class="p">)</span>      <span class="c1"># sampling techniques</span>
<span class="nf">library</span><span class="p">(</span><span class="n">broom</span><span class="p">)</span>      <span class="c1"># tidyverse: visualising statistical objects</span>
<span class="nf">library</span><span class="p">(</span><span class="n">pROC</span><span class="p">)</span>       <span class="c1"># visualising ROC curves</span>
<span class="nf">library</span><span class="p">(</span><span class="n">lmtest</span><span class="p">)</span>     <span class="c1"># tests for regression models</span>

<span class="c1"># packages below have some interaction with earlier packages, not always needed</span>
<span class="nf">library</span><span class="p">(</span><span class="n">arm</span><span class="p">)</span>        <span class="c1"># binned residual plot</span>
<span class="nf">library</span><span class="p">(</span><span class="n">msme</span><span class="p">)</span>       <span class="c1"># statistical tests, pearson dispersion</span>
<span class="nf">library</span><span class="p">(</span><span class="n">MASS</span><span class="p">)</span>       <span class="c1"># statistics</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_remove_input docutils container">
</div>
</div>
<div class="section" id="further-reading">
<h2>Further reading<a class="headerlink" href="#further-reading" title="Permalink to this headline">¶</a></h2>
<p>A few books and articles of interest:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://bookdown.org/yihui/rmarkdown-cookbook/">R Markdown Cookbook</a> has everything you need to know to set up an r markdown document like this one.</p></li>
<li><p><a class="reference external" href="https://www.cambridge.org/au/academic/subjects/statistics-probability/statistics-econometrics-finance-and-insurance/generalized-linear-models-insurance-data?format=HB&amp;isbn=9780521879149">Generalised Linear Models for Insurance Data</a> is a great book introducing GLMs in the context of insurance, considering problems specific to insurance data.</p></li>
<li><p><a class="reference external" href="https://www.tidyverse.org/">Tidyverse documentation</a> full set of documentation for Tidyverse packages (packages for data science) e.g. dplyr for data manipulation; tidyr for tidying up messy data; ggplot for visualisation.</p></li>
</ul>
</div>
</div>
<div class="tex2jax_ignore mathjax_ignore section" id="data-simulation">
<h1>Data Simulation<a class="headerlink" href="#data-simulation" title="Permalink to this headline">¶</a></h1>
<p>This section sets out a method for generating dummy data. The simulated data is intended to reflect typical data used in an analysis of disability income incidence experience and is used throughout this analysis. Replace this data with your actual data.</p>
<p>More detail on the techniques used can be found in the section on data manipulation.</p>
<div class="section" id="simulating-policies">
<h2>Simulating policies<a class="headerlink" href="#simulating-policies" title="Permalink to this headline">¶</a></h2>
<p>We start by simulating a mix of 200k policies over 3 years. Some simplifying assumptions e.g. nil lapse / new business (no allowance for part years of exposure), no indexation. Mix of business assumptions for benefit period, waiting period and occupation taken  taken from [&#64;BusMix], with the remainder based on an anecdotal view of industry mix not intended to be reflective of any one business.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># set the seed value (for the random number generator) so that the simulated data frame can be replicated later</span>
<span class="nf">set.seed</span><span class="p">(</span><span class="m">10</span><span class="p">)</span>
<span class="c1"># create 200k policies</span>
<span class="n">n</span> <span class="o">&lt;-</span> <span class="m">200000</span>

<span class="c1"># data frame columns</span>
<span class="c1"># policy_year skewed to early years, but tail is fat</span>
<span class="n">df</span> <span class="o">&lt;-</span> <span class="nf">data.frame</span><span class="p">(</span><span class="n">id</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="o">:</span><span class="n">n</span><span class="p">),</span> <span class="n">cal_year</span> <span class="o">=</span> <span class="m">2018</span><span class="p">,</span><span class="n">policy_year</span> <span class="o">=</span> <span class="nf">round</span><span class="p">(</span><span class="nf">rweibull</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="m">5</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="m">2</span><span class="p">),</span><span class="m">0</span><span class="p">))</span> 
<span class="n">df</span> <span class="o">&lt;-</span> <span class="n">df</span> <span class="o">%&gt;%</span> <span class="nf">mutate</span><span class="p">(</span><span class="n">sex</span> <span class="o">=</span> <span class="nf">replicate</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="nf">sample</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;m&quot;</span><span class="p">,</span><span class="s">&quot;f&quot;</span><span class="p">,</span><span class="s">&quot;u&quot;</span><span class="p">),</span> <span class="n">size</span><span class="o">=</span><span class="m">1</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span> <span class="n">prob</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="n">.</span><span class="m">75</span><span class="p">,</span><span class="n">.</span><span class="m">20</span><span class="p">,</span><span class="n">.</span><span class="m">05</span><span class="p">))),</span>
<span class="n">smoker</span> <span class="o">=</span> <span class="nf">replicate</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="nf">sample</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;n&quot;</span><span class="p">,</span><span class="s">&quot;s&quot;</span><span class="p">,</span><span class="s">&quot;u&quot;</span><span class="p">),</span> <span class="n">size</span><span class="o">=</span><span class="m">1</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span> <span class="n">prob</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="n">.</span><span class="m">85</span><span class="p">,</span><span class="n">.</span><span class="m">1</span><span class="p">,</span><span class="n">.</span><span class="m">05</span><span class="p">))),</span>
<span class="c1"># mix of business for benefit_period, waiting_period, occupation taken from industry presentation</span>
<span class="n">benefit_period</span> <span class="o">=</span> <span class="nf">replicate</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="nf">sample</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;a65&quot;</span><span class="p">,</span><span class="s">&quot;2yr&quot;</span><span class="p">,</span><span class="s">&quot;5yr&quot;</span><span class="p">),</span> <span class="n">size</span><span class="o">=</span><span class="m">1</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span> <span class="n">prob</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="n">.</span><span class="m">76</span><span class="p">,</span><span class="n">.</span><span class="m">12</span><span class="p">,</span><span class="n">.</span><span class="m">12</span><span class="p">))),</span>
<span class="n">waiting_period</span> <span class="o">=</span> <span class="nf">replicate</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="nf">sample</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;14d&quot;</span><span class="p">,</span><span class="s">&quot;30d&quot;</span><span class="p">,</span><span class="s">&quot;90d&quot;</span><span class="p">,</span><span class="s">&quot;720d&quot;</span><span class="p">),</span> <span class="n">size</span><span class="o">=</span><span class="m">1</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span> <span class="n">prob</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="n">.</span><span class="m">04</span><span class="p">,</span><span class="n">.</span><span class="m">7</span><span class="p">,</span><span class="n">.</span><span class="m">15</span><span class="p">,</span><span class="n">.</span><span class="m">11</span><span class="p">))),</span>
<span class="n">occupation</span> <span class="o">=</span> <span class="nf">replicate</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="nf">sample</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="s">&quot;prof&quot;</span><span class="p">,</span><span class="s">&quot;sed&quot;</span><span class="p">,</span><span class="s">&quot;techn&quot;</span><span class="p">,</span><span class="s">&quot;blue&quot;</span><span class="p">,</span><span class="s">&quot;white&quot;</span><span class="p">),</span> <span class="n">size</span><span class="o">=</span><span class="m">1</span><span class="p">,</span> <span class="n">replace</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">,</span> <span class="n">prob</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="n">.</span><span class="m">4</span><span class="p">,</span><span class="n">.</span><span class="m">2</span><span class="p">,</span><span class="n">.</span><span class="m">2</span><span class="p">,</span><span class="n">.</span><span class="m">1</span><span class="p">,</span><span class="n">.</span><span class="m">1</span><span class="p">))),</span>
<span class="c1"># age and policy year correlated; age normally distributed around 40 + policy_year (where policy_year is distributed around 5 years), floored at 25, capped at 60</span>
<span class="n">age</span> <span class="o">=</span> <span class="nf">round</span><span class="p">(</span><span class="nf">pmax</span><span class="p">(</span><span class="nf">pmin</span><span class="p">(</span><span class="nf">rnorm</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">mean</span> <span class="o">=</span> <span class="m">40</span><span class="o">+</span><span class="n">policy_year</span><span class="p">,</span> <span class="n">sd</span> <span class="o">=</span> <span class="m">5</span><span class="p">),</span><span class="m">60</span><span class="p">),</span><span class="m">25</span><span class="p">),</span><span class="m">0</span><span class="p">),</span>
<span class="c1"># sum_assured, age and occupation are correlated; sum assured normally distributed around some mean (dependent on age rounded to 10 and on occupation), floored at 500</span>
<span class="n">sum_assured</span> <span class="o">=</span> 
  <span class="nf">round</span><span class="p">(</span>
    <span class="nf">pmax</span><span class="p">(</span>
      <span class="nf">rnorm</span><span class="p">(</span><span class="n">n</span><span class="p">,</span><span class="n">mean</span> <span class="o">=</span> <span class="p">(</span><span class="nf">round</span><span class="p">(</span><span class="n">age</span><span class="p">,</span><span class="m">-1</span><span class="p">)</span><span class="o">*</span><span class="m">100</span><span class="o">+</span> <span class="m">1000</span><span class="p">)</span> <span class="o">*</span> 
      <span class="nf">case_when</span><span class="p">(</span><span class="n">occupation</span> <span class="o">%in%</span> <span class="nf">c</span><span class="p">(</span><span class="s">&quot;white&quot;</span><span class="p">,</span><span class="s">&quot;prof&quot;</span><span class="p">)</span> <span class="o">~</span> <span class="m">1.5</span><span class="p">,</span> <span class="n">occupation</span> <span class="o">%in%</span> <span class="nf">c</span><span class="p">(</span><span class="s">&quot;sed&quot;</span><span class="p">)</span> <span class="o">~</span> <span class="m">1.3</span> <span class="p">,</span> <span class="kc">TRUE</span> <span class="o">~</span> <span class="m">1</span><span class="p">),</span> 
      <span class="n">sd</span> <span class="o">=</span> <span class="m">2000</span><span class="p">),</span><span class="m">500</span><span class="p">),</span>
      <span class="m">0</span><span class="p">)</span>
  <span class="p">)</span>
<span class="c1"># generate 3 years of exposure for the 200k policies =&gt; assume no lapses or new business</span>
<span class="n">df2</span> <span class="o">&lt;-</span> <span class="n">df</span> <span class="o">%&gt;%</span> <span class="nf">mutate</span><span class="p">(</span><span class="n">cal_year</span><span class="o">=</span><span class="n">cal_year</span><span class="m">+1</span><span class="p">,</span><span class="n">policy_year</span><span class="o">=</span><span class="n">policy_year</span><span class="m">+1</span><span class="p">,</span><span class="n">age</span><span class="o">=</span><span class="n">age</span><span class="m">+1</span><span class="p">)</span>
<span class="n">df3</span> <span class="o">&lt;-</span> <span class="n">df2</span> <span class="o">%&gt;%</span> <span class="nf">mutate</span><span class="p">(</span><span class="n">cal_year</span><span class="o">=</span><span class="n">cal_year</span><span class="m">+1</span><span class="p">,</span><span class="n">policy_year</span><span class="o">=</span><span class="n">policy_year</span><span class="m">+1</span><span class="p">,</span><span class="n">age</span><span class="o">=</span><span class="n">age</span><span class="m">+1</span><span class="p">)</span>
<span class="n">df</span> <span class="o">&lt;-</span> <span class="nf">rbind</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="n">df2</span><span class="p">,</span><span class="n">df3</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="expected-claim-rate">
<h2>Expected claim rate<a class="headerlink" href="#expected-claim-rate" title="Permalink to this headline">¶</a></h2>
<p>Set p values from which to simulate claims. The crude p values below were derived from the Society of Actuaries Analysis of USA Individual Disability Claim Incidence Experience from 2006 to 2014 [&#64;SOA_study], with some allowance for Australian industry differentials [&#64;BusMix_FSC].</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># by cause, age and sex, based upon polynomials fitted to crude actual rates</span>
<span class="c1"># sickness</span>
<span class="n">f_sick_age_m</span> <span class="o">&lt;-</span> <span class="nf">function</span><span class="p">(</span><span class="n">age</span><span class="p">)</span> <span class="p">{</span><span class="m">-0.0000003</span><span class="o">*</span><span class="n">age</span><span class="o">^</span><span class="m">3</span> <span class="o">+</span> <span class="m">0.000047</span><span class="o">*</span><span class="n">age</span><span class="o">^</span><span class="m">2</span> <span class="o">-</span> <span class="m">0.00203</span><span class="o">*</span><span class="n">age</span> <span class="o">+</span> <span class="m">0.02715</span><span class="p">}</span>
<span class="n">f_sick_age_f</span> <span class="o">&lt;-</span> <span class="nf">function</span><span class="p">(</span><span class="n">age</span><span class="p">)</span> <span class="p">{</span><span class="m">-0.0000002</span><span class="o">*</span><span class="n">age</span><span class="o">^</span><span class="m">3</span> <span class="o">+</span> <span class="m">0.000026</span><span class="o">*</span><span class="n">age</span><span class="o">^</span><span class="m">2</span> <span class="o">-</span> <span class="m">0.00107</span><span class="o">*</span><span class="n">age</span> <span class="o">+</span> <span class="m">0.01550</span><span class="p">}</span> 	  	 	  
<span class="n">f_sick_age_u</span> <span class="o">&lt;-</span> <span class="nf">function</span><span class="p">(</span><span class="n">age</span><span class="p">)</span> <span class="p">{</span><span class="nf">f_sick_age_f</span><span class="p">(</span><span class="n">age</span><span class="p">)</span><span class="o">*</span><span class="m">1.2</span><span class="p">}</span>
<span class="n">f_sick_age</span>   <span class="o">&lt;-</span> <span class="nf">function</span><span class="p">(</span><span class="n">age</span><span class="p">,</span><span class="n">sex</span><span class="p">)</span> <span class="p">{</span><span class="nf">case_when</span><span class="p">(</span><span class="n">sex</span> <span class="o">==</span> <span class="s">&quot;m&quot;</span> <span class="o">~</span> <span class="nf">f_sick_age_m</span><span class="p">(</span><span class="n">age</span><span class="p">),</span> <span class="n">sex</span> <span class="o">==</span> <span class="s">&quot;f&quot;</span> <span class="o">~</span> <span class="nf">f_sick_age_f</span><span class="p">(</span><span class="n">age</span><span class="p">),</span> <span class="n">sex</span> <span class="o">==</span> <span class="s">&quot;u&quot;</span> <span class="o">~</span> <span class="nf">f_sick_age_u</span><span class="p">(</span><span class="n">age</span><span class="p">))}</span>

<span class="c1"># accident</span>
<span class="n">f_acc_age_m</span> <span class="o">&lt;-</span> <span class="nf">function</span><span class="p">(</span><span class="n">age</span><span class="p">)</span> <span class="p">{</span><span class="m">-0.00000002</span><span class="o">*</span><span class="n">age</span><span class="o">^</span><span class="m">3</span> <span class="o">+</span> <span class="m">0.000004</span><span class="o">*</span><span class="n">age</span><span class="o">^</span><span class="m">2</span> <span class="o">-</span> <span class="m">0.00020</span><span class="o">*</span><span class="n">age</span> <span class="o">+</span> <span class="m">0.00340</span><span class="p">}</span>
<span class="n">f_acc_age_f</span> <span class="o">&lt;-</span> <span class="nf">function</span><span class="p">(</span><span class="n">age</span><span class="p">)</span> <span class="p">{</span><span class="m">-0.00000004</span><span class="o">*</span><span class="n">age</span><span class="o">^</span><span class="m">3</span> <span class="o">+</span> <span class="m">0.000007</span><span class="o">*</span><span class="n">age</span><span class="o">^</span><span class="m">2</span> <span class="o">-</span> <span class="m">0.00027</span><span class="o">*</span><span class="n">age</span> <span class="o">+</span> <span class="m">0.00374</span><span class="p">}</span> 	  	 	  
<span class="n">f_acc_age_u</span> <span class="o">&lt;-</span> <span class="nf">function</span><span class="p">(</span><span class="n">age</span><span class="p">)</span> <span class="p">{</span><span class="nf">f_sick_age_f</span><span class="p">(</span><span class="n">age</span><span class="p">)</span><span class="o">*</span><span class="m">1.2</span><span class="p">}</span>
<span class="n">f_acc_age</span>   <span class="o">&lt;-</span> <span class="nf">function</span><span class="p">(</span><span class="n">age</span><span class="p">,</span><span class="n">sex</span><span class="p">)</span> <span class="p">{</span><span class="nf">case_when</span><span class="p">(</span><span class="n">sex</span> <span class="o">==</span> <span class="s">&quot;m&quot;</span> <span class="o">~</span> <span class="nf">f_acc_age_m</span><span class="p">(</span><span class="n">age</span><span class="p">),</span> <span class="n">sex</span> <span class="o">==</span> <span class="s">&quot;f&quot;</span> <span class="o">~</span> <span class="nf">f_acc_age_f</span><span class="p">(</span><span class="n">age</span><span class="p">),</span> <span class="n">sex</span> <span class="o">==</span> <span class="s">&quot;u&quot;</span> <span class="o">~</span> <span class="nf">f_acc_age_u</span><span class="p">(</span><span class="n">age</span><span class="p">))}</span>

<span class="c1"># smoker, wp and occ based upon ratio of crude actual rates by category</span>
<span class="c1"># occupation adjustment informed by FSC commentary on DI incidence experience</span>
<span class="n">f_smoker</span>   <span class="o">&lt;-</span> <span class="nf">function</span><span class="p">(</span><span class="n">smoker</span><span class="p">)</span> <span class="p">{</span><span class="nf">case_when</span><span class="p">(</span><span class="n">smoker</span> <span class="o">==</span> <span class="s">&quot;n&quot;</span> <span class="o">~</span> <span class="m">1</span><span class="p">,</span> <span class="n">smoker</span> <span class="o">==</span> <span class="s">&quot;s&quot;</span> <span class="o">~</span> <span class="m">1.45</span><span class="p">,</span> <span class="n">smoker</span> <span class="o">==</span> <span class="s">&quot;u&quot;</span> <span class="o">~</span> <span class="m">0.9</span><span class="p">)}</span>
<span class="n">f_wp</span>   <span class="o">&lt;-</span> <span class="nf">function</span><span class="p">(</span><span class="n">waiting_period</span><span class="p">)</span> <span class="p">{</span><span class="nf">case_when</span><span class="p">(</span><span class="n">waiting_period</span> <span class="o">==</span> <span class="s">&quot;14d&quot;</span> <span class="o">~</span> <span class="m">1.4</span><span class="p">,</span> <span class="n">waiting_period</span> <span class="o">==</span> <span class="s">&quot;30d&quot;</span> <span class="o">~</span> <span class="m">1</span><span class="p">,</span> <span class="n">waiting_period</span> <span class="o">==</span> <span class="s">&quot;90d&quot;</span> <span class="o">~</span> <span class="m">0.3</span><span class="p">,</span> <span class="n">waiting_period</span> <span class="o">==</span> <span class="s">&quot;720d&quot;</span> <span class="o">~</span> <span class="m">0.2</span><span class="p">)}</span>
<span class="n">f_occ_sick</span>   <span class="o">&lt;-</span> <span class="nf">function</span><span class="p">(</span><span class="n">occupation</span><span class="p">)</span> <span class="p">{</span><span class="nf">case_when</span><span class="p">(</span><span class="n">occupation</span> <span class="o">==</span> <span class="s">&quot;prof&quot;</span> <span class="o">~</span> <span class="m">1</span><span class="p">,</span> <span class="n">occupation</span> <span class="o">==</span> <span class="s">&quot;sed&quot;</span> <span class="o">~</span> <span class="m">1</span><span class="p">,</span> <span class="n">occupation</span> <span class="o">==</span> <span class="s">&quot;techn&quot;</span> <span class="o">~</span> <span class="m">1</span><span class="p">,</span> <span class="n">occupation</span> <span class="o">==</span> <span class="s">&quot;blue&quot;</span> <span class="o">~</span> <span class="m">1</span><span class="p">,</span> <span class="n">occupation</span> <span class="o">==</span> <span class="s">&quot;white&quot;</span> <span class="o">~</span> <span class="m">1</span><span class="p">)}</span>
<span class="n">f_occ_acc</span>   <span class="o">&lt;-</span> <span class="nf">function</span><span class="p">(</span><span class="n">occupation</span><span class="p">)</span> <span class="p">{</span><span class="nf">case_when</span><span class="p">(</span><span class="n">occupation</span> <span class="o">==</span> <span class="s">&quot;prof&quot;</span> <span class="o">~</span> <span class="m">1</span><span class="p">,</span> <span class="n">occupation</span> <span class="o">==</span> <span class="s">&quot;sed&quot;</span> <span class="o">~</span> <span class="m">1</span><span class="p">,</span> <span class="n">occupation</span> <span class="o">==</span> <span class="s">&quot;techn&quot;</span> <span class="o">~</span> <span class="m">4.5</span><span class="p">,</span> <span class="n">occupation</span> <span class="o">==</span> <span class="s">&quot;blue&quot;</span> <span class="o">~</span> <span class="m">4.5</span><span class="p">,</span> <span class="n">occupation</span> <span class="o">==</span> <span class="s">&quot;white&quot;</span> <span class="o">~</span> <span class="m">1</span><span class="p">)}</span>

<span class="c1"># anecdotal allowance for higher rates at larger policy size and for older policies</span>
<span class="n">f_sa_sick</span> <span class="o">&lt;-</span> <span class="nf">function</span><span class="p">(</span><span class="n">sum_assured</span><span class="p">)</span> <span class="p">{</span><span class="nf">case_when</span><span class="p">(</span><span class="n">sum_assured</span><span class="o">&lt;=</span><span class="m">6000</span> <span class="o">~</span> <span class="m">1</span><span class="p">,</span> <span class="n">sum_assured</span><span class="o">&gt;</span><span class="m">6000</span> <span class="o">&amp;</span> <span class="n">sum_assured</span><span class="o">&lt;=</span><span class="m">10000</span> <span class="o">~</span> <span class="m">1.1</span><span class="p">,</span> <span class="n">sum_assured</span><span class="o">&gt;</span><span class="m">10000</span> <span class="o">~</span> <span class="m">1.3</span><span class="p">)}</span>
<span class="n">f_sa_acc</span> <span class="o">&lt;-</span> <span class="nf">function</span><span class="p">(</span><span class="n">sum_assured</span><span class="p">)</span> <span class="p">{</span><span class="nf">case_when</span><span class="p">(</span><span class="n">sum_assured</span><span class="o">&lt;=</span><span class="m">6000</span> <span class="o">~</span> <span class="m">1</span><span class="p">,</span> <span class="n">sum_assured</span><span class="o">&gt;</span><span class="m">6000</span> <span class="o">&amp;</span> <span class="n">sum_assured</span><span class="o">&lt;=</span><span class="m">10000</span> <span class="o">~</span> <span class="m">1</span><span class="p">,</span> <span class="n">sum_assured</span><span class="o">&gt;</span><span class="m">10000</span> <span class="o">~</span> <span class="m">1</span><span class="p">)}</span>
<span class="n">f_pol_yr_sick</span> <span class="o">&lt;-</span> <span class="nf">function</span><span class="p">(</span><span class="n">policy_year</span><span class="p">)</span> <span class="p">{</span><span class="nf">case_when</span><span class="p">(</span><span class="n">policy_year</span><span class="o">&lt;=</span><span class="m">5</span> <span class="o">~</span> <span class="m">1</span><span class="p">,</span> <span class="n">policy_year</span><span class="o">&gt;</span><span class="m">5</span> <span class="o">&amp;</span> <span class="n">policy_year</span><span class="o">&lt;=</span><span class="m">10</span> <span class="o">~</span> <span class="m">1.1</span><span class="p">,</span> <span class="n">policy_year</span><span class="o">&gt;</span><span class="m">10</span> <span class="o">~</span> <span class="m">1.3</span><span class="p">)}</span>
<span class="n">f_pol_yr_acc</span> <span class="o">&lt;-</span> <span class="nf">function</span><span class="p">(</span><span class="n">policy_year</span><span class="p">)</span> <span class="p">{</span><span class="nf">case_when</span><span class="p">(</span><span class="n">policy_year</span><span class="o">&lt;=</span><span class="m">5</span> <span class="o">~</span> <span class="m">1</span><span class="p">,</span> <span class="n">policy_year</span><span class="o">&gt;</span><span class="m">5</span> <span class="o">&amp;</span> <span class="n">policy_year</span><span class="o">&lt;=</span><span class="m">10</span> <span class="o">~</span> <span class="m">1</span><span class="p">,</span> <span class="n">policy_year</span><span class="o">&gt;</span><span class="m">10</span> <span class="o">~</span> <span class="m">1</span><span class="p">)}</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="expected-claims">
<h2>Expected claims<a class="headerlink" href="#expected-claims" title="Permalink to this headline">¶</a></h2>
<p>Add the crude p values to the data and simulate 1 draw from a binomial with prob = p for each record. Gives us a vector of claim/no-claim for each policy. Some simplifying assumptions like independence of sample across years for each policy and independence of accident and sickness incidences.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># add crude expected</span>
<span class="n">df</span><span class="o">$</span><span class="n">inc_sick_expected</span><span class="o">=</span><span class="nf">f_sick_age</span><span class="p">(</span><span class="n">df</span><span class="o">$</span><span class="n">age</span><span class="p">,</span><span class="n">df</span><span class="o">$</span><span class="n">sex</span><span class="p">)</span><span class="o">*</span><span class="nf">f_smoker</span><span class="p">(</span><span class="n">df</span><span class="o">$</span><span class="n">smoker</span><span class="p">)</span><span class="o">*</span><span class="nf">f_wp</span><span class="p">(</span><span class="n">df</span><span class="o">$</span><span class="n">waiting_period</span><span class="p">)</span><span class="o">*</span><span class="nf">f_occ_sick</span><span class="p">(</span><span class="n">df</span><span class="o">$</span><span class="n">occupation</span><span class="p">)</span><span class="o">*</span><span class="nf">f_sa_sick</span><span class="p">(</span><span class="n">df</span><span class="o">$</span><span class="n">sum_assured</span><span class="p">)</span><span class="o">*</span><span class="nf">f_pol_yr_sick</span><span class="p">(</span><span class="n">df</span><span class="o">$</span><span class="n">policy_year</span><span class="p">)</span>
<span class="n">df</span><span class="o">$</span><span class="n">inc_acc_expected</span><span class="o">=</span><span class="nf">f_acc_age</span><span class="p">(</span><span class="n">df</span><span class="o">$</span><span class="n">age</span><span class="p">,</span><span class="n">df</span><span class="o">$</span><span class="n">sex</span><span class="p">)</span><span class="o">*</span><span class="nf">f_smoker</span><span class="p">(</span><span class="n">df</span><span class="o">$</span><span class="n">smoker</span><span class="p">)</span><span class="o">*</span><span class="nf">f_wp</span><span class="p">(</span><span class="n">df</span><span class="o">$</span><span class="n">waiting_period</span><span class="p">)</span><span class="o">*</span><span class="nf">f_occ_acc</span><span class="p">(</span><span class="n">df</span><span class="o">$</span><span class="n">occupation</span><span class="p">)</span><span class="o">*</span><span class="nf">f_sa_acc</span><span class="p">(</span><span class="n">df</span><span class="o">$</span><span class="n">sum_assured</span><span class="p">)</span><span class="o">*</span><span class="nf">f_pol_yr_acc</span><span class="p">(</span><span class="n">df</span><span class="o">$</span><span class="n">policy_year</span><span class="p">)</span>
<span class="c1"># add prediction</span>
<span class="n">df</span><span class="o">$</span><span class="n">inc_count_sick</span> <span class="o">=</span> <span class="nf">sapply</span><span class="p">(</span><span class="n">df</span><span class="o">$</span><span class="n">inc_sick_expected</span><span class="p">,</span><span class="nf">function</span><span class="p">(</span><span class="n">z</span><span class="p">){</span><span class="nf">rbinom</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="n">z</span><span class="p">)})</span>
<span class="n">df</span><span class="o">$</span><span class="n">inc_count_acc</span> <span class="o">=</span> <span class="nf">sapply</span><span class="p">(</span><span class="n">df</span><span class="o">$</span><span class="n">inc_acc_expected</span><span class="p">,</span><span class="nf">function</span><span class="p">(</span><span class="n">z</span><span class="p">){</span><span class="nf">rbinom</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="n">z</span><span class="p">)})</span><span class="o">*</span><span class="p">(</span><span class="m">1</span><span class="o">-</span><span class="n">df</span><span class="o">$</span><span class="n">inc_count_sick</span><span class="p">)</span>
<span class="n">df</span><span class="o">$</span><span class="n">inc_count_tot</span> <span class="o">=</span> <span class="n">df</span><span class="o">$</span><span class="n">inc_count_sick</span> <span class="o">+</span> <span class="n">df</span><span class="o">$</span><span class="n">inc_count_acc</span>
<span class="c1"># add amounts prediction</span>
<span class="n">df</span><span class="o">$</span><span class="n">inc_amount_sick</span> <span class="o">=</span> <span class="n">df</span><span class="o">$</span><span class="n">inc_count_sick</span> <span class="o">*</span> <span class="n">df</span><span class="o">$</span><span class="n">sum_assured</span>
<span class="n">df</span><span class="o">$</span><span class="n">inc_amount_acc</span> <span class="o">=</span>  <span class="n">df</span><span class="o">$</span><span class="n">inc_count_acc</span> <span class="o">*</span> <span class="n">df</span><span class="o">$</span><span class="n">sum_assured</span>
<span class="n">df</span><span class="o">$</span><span class="n">inc_amount_tot</span> <span class="o">=</span>  <span class="n">df</span><span class="o">$</span><span class="n">inc_count_tot</span> <span class="o">*</span> <span class="n">df</span><span class="o">$</span><span class="n">sum_assured</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="grouped-data">
<h2>Grouped data<a class="headerlink" href="#grouped-data" title="Permalink to this headline">¶</a></h2>
<p>The data generated above are records for each individual policy, however data like this is often grouped as it is easier to store and computation is easier [&#64;GLM_Insurance, p49, 105]. Later we will consider the differences between a model on ungrouped vs grouped data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># group data (see section on data manipulation below)</span>
<span class="n">df_grp</span> <span class="o">&lt;-</span> <span class="n">df</span> <span class="o">%&gt;%</span> <span class="nf">group_by</span><span class="p">(</span><span class="n">cal_year</span><span class="p">,</span> <span class="n">policy_year</span><span class="p">,</span> <span class="n">sex</span><span class="p">,</span> <span class="n">smoker</span><span class="p">,</span> <span class="n">benefit_period</span><span class="p">,</span> <span class="n">waiting_period</span><span class="p">,</span> <span class="n">occupation</span><span class="p">,</span> <span class="n">age</span><span class="p">)</span> <span class="o">%&gt;%</span> 
<span class="nf">summarise</span><span class="p">(</span><span class="n">sum_assured</span><span class="o">=</span><span class="nf">sum</span><span class="p">(</span><span class="n">sum_assured</span><span class="p">),</span><span class="n">inc_count_sick_exp</span><span class="o">=</span><span class="nf">sum</span><span class="p">(</span><span class="n">inc_sick_expected</span><span class="p">),</span><span class="n">inc_count_acc_exp</span><span class="o">=</span><span class="nf">sum</span><span class="p">(</span><span class="n">inc_acc_expected</span><span class="p">),</span>        <span class="n">inc_count_sick</span><span class="o">=</span><span class="nf">sum</span><span class="p">(</span><span class="n">inc_count_sick</span><span class="p">),</span><span class="n">inc_count_acc</span><span class="o">=</span><span class="nf">sum</span><span class="p">(</span><span class="n">inc_count_acc</span><span class="p">),</span><span class="n">inc_count_tot</span><span class="o">=</span><span class="nf">sum</span><span class="p">(</span><span class="n">inc_count_tot</span><span class="p">),</span><span class="n">inc_amount_sick</span><span class="o">=</span><span class="nf">sum</span><span class="p">(</span><span class="n">inc_amount_sick</span><span class="p">),</span><span class="n">inc_amount_acc</span><span class="o">=</span><span class="nf">sum</span><span class="p">(</span><span class="n">inc_amount_acc</span><span class="p">),</span><span class="n">inc_amount_tot</span><span class="o">=</span><span class="nf">sum</span><span class="p">(</span><span class="n">inc_amount_tot</span><span class="p">),</span> <span class="n">exposure</span><span class="o">=</span><span class="nf">n</span><span class="p">(),</span><span class="n">.groups</span> <span class="o">=</span> <span class="s">&#39;drop&#39;</span><span class="p">)</span> 
</pre></div>
</div>
</div>
</div>
<p>Check that the exposure for the grouped data is the same as the total on ungrouped:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># check count - same as total row count of the main df</span>
<span class="nf">sum</span><span class="p">(</span><span class="n">df_grp</span><span class="o">$</span><span class="n">exposure</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>And that the number of rows of data are significantly lower:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># number of rows of the grouped data is significantly lower</span>
<span class="nf">nrow</span><span class="p">(</span><span class="n">df_grp</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="tex2jax_ignore mathjax_ignore section" id="data-exploration">
<h1>Data Exploration<a class="headerlink" href="#data-exploration" title="Permalink to this headline">¶</a></h1>
<p>The sections below rely heavily upon the dplyr package.</p>
<div class="section" id="data-structure">
<h2>Data structure<a class="headerlink" href="#data-structure" title="Permalink to this headline">¶</a></h2>
<p>Looking at the metadata for the data frame and a sample of the contents.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># MASS package interferes with select()</span>
<span class="n">select</span> <span class="o">&lt;-</span> <span class="n">dplyr</span><span class="o">::</span><span class="n">select</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># glimpse() or str() returns detail on the structure of the data frame. Our data consists of 600k rows and 15 columns. The columns are policy ID, several explanatory variables like sex and smoker, expected counts of claim (inc_sick_expected and inc_acc_expected) and actual counts of claim (inc_count_sick/acc/tot).</span>
<span class="nf">glimpse</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># head() returns the first 6 rows of the data frame. Similar to head(), sample_n() returns rows from our data frame, however these are chosen randomly. e.g. sample_n(df,5,replace=FALSE)</span>
<span class="nf">head</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># class() returns the class of a column.</span>
<span class="nf">class</span><span class="p">(</span><span class="n">df</span><span class="o">$</span><span class="n">benefit_period</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="factors">
<h2>Factors<a class="headerlink" href="#factors" title="Permalink to this headline">¶</a></h2>
<p>From the above you’ll note that the categorical columns are stored as characters. Factorising these makes them easier to work with in our models e.g. for BP factorise a65|2yr|5yr as 1|2|3. Factors are stored as integers and have labels that tell us what they are, they can be ordered and are useful for statistical analysis.</p>
<p><code class="docutils literal notranslate"><span class="pre">table()</span></code> returns a table of counts at each combination of column values. <code class="docutils literal notranslate"><span class="pre">prop.table()</span></code> converts these to a proportion. For example, applying this to the column “sex” shows us that ~75% of our data is “m” and that the other data are either “f” or “u” (unknown).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">table</span><span class="p">(</span><span class="n">df</span><span class="o">$</span><span class="n">sex</span><span class="p">)</span>
<span class="nf">prop.table</span><span class="p">(</span><span class="nf">table</span><span class="p">(</span><span class="n">df</span><span class="o">$</span><span class="n">sex</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>We can then convert the columns to factors based upon the values of the column and ordering by frequency. Base level should be chosen such that it has sufficient observations for an intercept to be computed meaningfully.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">df</span><span class="o">$</span><span class="n">sex</span> <span class="o">&lt;-</span> <span class="nf">factor</span><span class="p">(</span><span class="n">df</span><span class="o">$</span><span class="n">sex</span><span class="p">,</span> <span class="n">levels</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="s">&quot;m&quot;</span><span class="p">,</span><span class="s">&quot;f&quot;</span><span class="p">,</span><span class="s">&quot;u&quot;</span><span class="p">))</span>
<span class="n">df</span><span class="o">$</span><span class="n">smoker</span> <span class="o">&lt;-</span> <span class="nf">factor</span><span class="p">(</span><span class="n">df</span><span class="o">$</span><span class="n">smoker</span><span class="p">,</span> <span class="n">levels</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="s">&quot;n&quot;</span><span class="p">,</span><span class="s">&quot;s&quot;</span><span class="p">,</span><span class="s">&quot;u&quot;</span><span class="p">))</span>
<span class="n">df</span><span class="o">$</span><span class="n">benefit_period</span> <span class="o">&lt;-</span> <span class="nf">factor</span><span class="p">(</span><span class="n">df</span><span class="o">$</span><span class="n">benefit_period</span><span class="p">,</span> <span class="n">levels</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="s">&quot;a65&quot;</span><span class="p">,</span><span class="s">&quot;2yr&quot;</span><span class="p">,</span><span class="s">&quot;5yr&quot;</span><span class="p">))</span>
<span class="n">df</span><span class="o">$</span><span class="n">waiting_period</span> <span class="o">&lt;-</span> <span class="nf">factor</span><span class="p">(</span><span class="n">df</span><span class="o">$</span><span class="n">waiting_period</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="s">&quot;30d&quot;</span><span class="p">,</span><span class="s">&quot;14d&quot;</span><span class="p">,</span><span class="s">&quot;720d&quot;</span><span class="p">,</span><span class="s">&quot;90d&quot;</span><span class="p">))</span>
<span class="n">df</span><span class="o">$</span><span class="n">occupation</span> <span class="o">&lt;-</span> <span class="nf">factor</span><span class="p">(</span><span class="n">df</span><span class="o">$</span><span class="n">occupation</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="s">&quot;prof&quot;</span><span class="p">,</span> <span class="s">&quot;sed&quot;</span><span class="p">,</span><span class="s">&quot;techn&quot;</span><span class="p">,</span><span class="s">&quot;white&quot;</span><span class="p">,</span><span class="s">&quot;blue&quot;</span><span class="p">))</span>

<span class="c1"># do the same for the grouped data</span>
<span class="n">df_grp</span><span class="o">$</span><span class="n">sex</span> <span class="o">&lt;-</span> <span class="nf">factor</span><span class="p">(</span><span class="n">df_grp</span><span class="o">$</span><span class="n">sex</span><span class="p">,</span> <span class="n">levels</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="s">&quot;m&quot;</span><span class="p">,</span><span class="s">&quot;f&quot;</span><span class="p">,</span><span class="s">&quot;u&quot;</span><span class="p">))</span>
<span class="n">df_grp</span><span class="o">$</span><span class="n">smoker</span> <span class="o">&lt;-</span> <span class="nf">factor</span><span class="p">(</span><span class="n">df_grp</span><span class="o">$</span><span class="n">smoker</span><span class="p">,</span> <span class="n">levels</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="s">&quot;n&quot;</span><span class="p">,</span><span class="s">&quot;s&quot;</span><span class="p">,</span><span class="s">&quot;u&quot;</span><span class="p">))</span>
<span class="n">df_grp</span><span class="o">$</span><span class="n">benefit_period</span> <span class="o">&lt;-</span> <span class="nf">factor</span><span class="p">(</span><span class="n">df_grp</span><span class="o">$</span><span class="n">benefit_period</span><span class="p">,</span> <span class="n">levels</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="s">&quot;a65&quot;</span><span class="p">,</span><span class="s">&quot;2yr&quot;</span><span class="p">,</span><span class="s">&quot;5yr&quot;</span><span class="p">))</span>
<span class="n">df_grp</span><span class="o">$</span><span class="n">waiting_period</span> <span class="o">&lt;-</span> <span class="nf">factor</span><span class="p">(</span><span class="n">df_grp</span><span class="o">$</span><span class="n">waiting_period</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="s">&quot;30d&quot;</span><span class="p">,</span><span class="s">&quot;14d&quot;</span><span class="p">,</span><span class="s">&quot;720d&quot;</span><span class="p">,</span><span class="s">&quot;90d&quot;</span><span class="p">))</span>
<span class="n">df_grp</span><span class="o">$</span><span class="n">occupation</span> <span class="o">&lt;-</span> <span class="nf">factor</span><span class="p">(</span><span class="n">df_grp</span><span class="o">$</span><span class="n">occupation</span><span class="p">,</span> <span class="n">labels</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="s">&quot;prof&quot;</span><span class="p">,</span> <span class="s">&quot;sed&quot;</span><span class="p">,</span><span class="s">&quot;techn&quot;</span><span class="p">,</span><span class="s">&quot;white&quot;</span><span class="p">,</span><span class="s">&quot;blue&quot;</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>If the column is already a factor, you can extract the levels to show what order they will be used in our models</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">table</span><span class="p">(</span><span class="nf">levels</span><span class="p">(</span><span class="n">df</span><span class="o">$</span><span class="n">sex</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="selection-methods">
<h2>Selection methods<a class="headerlink" href="#selection-methods" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">table()</span></code> is a method of summarizing data, returning a count at each combination of values in a column. <code class="docutils literal notranslate"><span class="pre">sample()</span></code> and <code class="docutils literal notranslate"><span class="pre">sample_n()</span></code> are other examples of selection methods. This section (not exhaustive) looks at a few more selection methods in <code class="docutils literal notranslate"><span class="pre">dplyr</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">not_run_sample_only</span> <span class="o">&lt;-</span> <span class="nf">function</span><span class="p">(){</span>
<span class="c1"># data subsets:  e.g. select from df where age &lt;25 or &gt;60 </span>
    <span class="nf">subset</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">age</span> <span class="o">&lt;</span><span class="m">25</span> <span class="o">|</span> <span class="n">age</span> <span class="o">&gt;</span> <span class="m">60</span><span class="p">)</span> 
<span class="c1">#	dropping columns:</span>
		<span class="c1"># exclude columns</span>
		<span class="n">mycols</span> <span class="o">&lt;-</span> <span class="nf">names</span><span class="p">(</span><span class="n">df</span><span class="p">)</span> <span class="o">%in%</span> <span class="nf">c</span><span class="p">(</span><span class="s">&quot;cal_year&quot;</span><span class="p">,</span> <span class="s">&quot;smoker&quot;</span><span class="p">)</span>
		<span class="n">new_df</span> <span class="o">&lt;-</span> <span class="n">df</span><span class="p">[</span><span class="o">!</span><span class="n">mycols</span><span class="p">]</span>
		<span class="c1"># exclude 3rd and 5th column</span>
		<span class="n">new_df</span> <span class="o">&lt;-</span> <span class="n">df</span><span class="p">[</span><span class="nf">c</span><span class="p">(</span><span class="m">-3</span><span class="p">,</span><span class="m">-5</span><span class="p">)]</span>
		<span class="c1"># delete columns v1 and v2 from new_df</span>
		<span class="n">new_df</span><span class="o">$</span><span class="n">v3</span> <span class="o">&lt;-</span> <span class="n">new_df</span><span class="o">$</span><span class="n">v5</span> <span class="o">&lt;-</span> <span class="kc">NULL</span>
<span class="c1">#	keeping columns: </span>
		<span class="c1"># select variables v1, v2, v3</span>
		<span class="n">mycols</span> <span class="o">&lt;-</span> <span class="nf">names</span><span class="p">(</span><span class="n">df</span><span class="p">)</span> <span class="o">%in%</span> <span class="nf">c</span><span class="p">(</span><span class="s">&quot;cal_year&quot;</span><span class="p">,</span> <span class="s">&quot;smoker&quot;</span><span class="p">)</span>
		<span class="n">new_df</span> <span class="o">&lt;-</span> <span class="n">df</span><span class="p">[</span><span class="o">!</span><span class="n">mycols</span><span class="p">]</span>
		<span class="c1"># select 1st and 5th to 7th variables</span>
    <span class="n">new_df</span> <span class="o">&lt;-</span> <span class="n">df</span><span class="p">[</span><span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">5</span><span class="o">:</span><span class="m">7</span><span class="p">)]</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="manipulation-methods">
<h2>Manipulation methods<a class="headerlink" href="#manipulation-methods" title="Permalink to this headline">¶</a></h2>
<p>We might want to modify our data frame to prepare it for fitting our models. The section below looks at a few simple data manipulations. Here we also introduce the infix operator (<code class="docutils literal notranslate"><span class="pre">%&gt;%</span></code>); this operator passes the argument to the left of it over to the code on the right, so <code class="docutils literal notranslate"><span class="pre">df</span> <span class="pre">%&gt;%</span></code> “operation” passes the data frame “df” over to the operation on the right.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">not_run_sample_only</span> <span class="o">&lt;-</span> <span class="nf">function</span><span class="p">(){</span>
<span class="c1"># create a copy of the dataframe to work from</span>
  <span class="n">new_df</span> <span class="o">&lt;-</span> <span class="n">df</span>
<span class="c1"># simple manipulations</span>
	<span class="c1"># select as in the selection methods section, but using infix</span>
	<span class="n">new_df</span> <span class="o">%&gt;%</span> <span class="nf">select</span><span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">age</span><span class="p">)</span> <span class="c1"># or a range using select(1:5) or select(contains(&quot;sick&quot;)) or select(starts_with(&quot;inc&quot;)); others e.g. ends_with(), last_col(), select(-age)</span>
	<span class="c1"># replace values in a column</span>
	<span class="nf">replace</span><span class="p">(</span><span class="n">new_df</span><span class="o">$</span><span class="n">sex</span><span class="p">,</span><span class="n">new_df</span><span class="o">$</span><span class="n">sex</span><span class="o">==</span><span class="s">&quot;u&quot;</span><span class="p">,</span><span class="s">&quot;m&quot;</span><span class="p">)</span> <span class="c1"># no infix in base r</span>
	<span class="c1"># Rename, id to pol_id</span>
	<span class="n">new_df</span> <span class="o">%&gt;%</span> <span class="nf">rename</span><span class="p">(</span><span class="n">pol_id</span> <span class="o">=</span> <span class="n">id</span><span class="p">)</span>  <span class="c1">#or (reversing the renaming)</span>
	<span class="n">new_df</span> <span class="o">%&gt;%</span> <span class="nf">select</span><span class="p">(</span><span class="n">pol_id</span> <span class="o">=</span> <span class="n">id</span><span class="p">)</span>  
	<span class="c1"># alter data</span>
	<span class="n">new_df</span> <span class="o">&lt;-</span> <span class="n">new_df</span> <span class="o">%&gt;%</span> <span class="nf">mutate</span><span class="p">(</span><span class="n">inc_tot_expected</span> <span class="o">=</span> <span class="n">inc_acc_expected</span> <span class="o">+</span> <span class="n">inc_sick_expected</span><span class="p">)</span> <span class="c1"># need to assign the output back to the data frame</span>
	<span class="c1"># transmute - select and mutate simultaneously </span>
	<span class="n">new_df2</span> <span class="o">&lt;-</span> <span class="n">new_df</span> <span class="o">%&gt;%</span> <span class="nf">transmute</span><span class="p">(</span><span class="n">id</span><span class="p">,</span> <span class="n">age</span><span class="p">,</span> <span class="n">birth_year</span> <span class="o">=</span> <span class="n">cal_year</span> <span class="o">-</span> <span class="n">age</span><span class="p">)</span>
	<span class="c1"># sort</span>
	<span class="n">new_df</span> <span class="o">%&gt;%</span> <span class="nf">arrange</span><span class="p">(</span><span class="nf">desc</span><span class="p">(</span><span class="n">age</span><span class="p">))</span>
	<span class="c1"># filter</span>
	<span class="n">new_df</span> <span class="o">%&gt;%</span> <span class="nf">filter</span><span class="p">(</span><span class="n">benefit_period</span> <span class="o">==</span> <span class="s">&quot;a65&quot;</span><span class="p">,</span> <span class="n">age</span> <span class="o">&lt;</span><span class="m">65</span><span class="p">)</span> <span class="c1"># or</span>
	<span class="n">new_df</span> <span class="o">%&gt;%</span> <span class="nf">filter</span><span class="p">(</span><span class="n">benefit_period</span> <span class="o">%in%</span> <span class="nf">c</span><span class="p">(</span><span class="s">&quot;a65&quot;</span><span class="p">,</span><span class="s">&quot;5yr&quot;</span><span class="p">))</span>
<span class="c1"># aggregations</span>
	<span class="c1"># group by, also ungroup()</span>
	<span class="n">new_df</span> <span class="o">%&gt;%</span> <span class="nf">group_by</span><span class="p">(</span><span class="n">sex</span><span class="p">)</span> <span class="o">%&gt;%</span> <span class="c1"># can add a mutate to group by which will aggregate only to the level specified in the group_by e.g. </span>
	<span class="nf">mutate</span><span class="p">(</span><span class="n">sa_by_sex</span> <span class="o">=</span> <span class="nf">sum</span><span class="p">(</span><span class="n">sum_assured</span><span class="p">))</span> <span class="c1"># adds a new column with the total sum assured by sex.</span>
	<span class="c1"># after doing this, ungroup() in order to apply future operations to all records individually</span>
	<span class="c1"># count, sorting by most frequent and weighting by another column</span>
	<span class="n">new_df</span> <span class="o">%&gt;%</span> <span class="nf">count</span><span class="p">(</span><span class="n">sex</span><span class="p">,</span> <span class="n">wt</span><span class="o">=</span> <span class="n">sum_assured</span><span class="p">,</span> <span class="n">sort</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">)</span>  <span class="c1"># counts the number of entries for each value of sex, weighted by sum assured</span>
	<span class="c1"># summarize takes many observations and turns them into one observation. mean(), median(), min(), max(), and n() for the size of the group</span>
	<span class="n">new_df</span> <span class="o">%&gt;%</span> <span class="nf">summarize</span><span class="p">(</span><span class="n">total</span> <span class="o">=</span> <span class="nf">sum</span><span class="p">(</span><span class="n">sum_assured</span><span class="p">),</span> <span class="n">min_age</span> <span class="o">=</span> <span class="nf">min</span><span class="p">(</span><span class="n">age</span><span class="p">),</span> <span class="n">max_age</span> <span class="o">=</span> <span class="nf">max</span><span class="p">(</span><span class="n">age</span><span class="p">),</span> <span class="nf">max</span><span class="p">(</span><span class="n">inc_tot_expected</span><span class="p">))</span> 
	<span class="n">new_df</span> <span class="o">%&gt;%</span> <span class="nf">group_by</span><span class="p">(</span><span class="n">sex</span><span class="p">)</span> <span class="o">%&gt;%</span> <span class="nf">summarise</span><span class="p">(</span><span class="n">n</span> <span class="o">=</span> <span class="nf">n</span><span class="p">())</span>
	<span class="nf">table</span><span class="p">(</span><span class="n">new_df</span><span class="o">$</span><span class="n">sex</span><span class="p">)</span> <span class="c1"># returns count by sex; no infix in base r</span>
<span class="c1"># outliers</span>
	<span class="n">new_df</span> <span class="o">%&gt;%</span> <span class="nf">top_n</span><span class="p">(</span><span class="m">10</span><span class="p">,</span> <span class="n">inc_tot_expected</span><span class="p">)</span> <span class="c1"># also operates on grouped table - returns top n per group</span>
<span class="c1"># window functions</span>
	<span class="c1"># lag - offset vector by 1 e.g. v &lt;- c(1,3,6,14); so - lag(v) = NA 1 3 6</span>
	<span class="n">new_df</span> <span class="o">%&gt;%</span> <span class="nf">arrange</span><span class="p">(</span><span class="n">id</span><span class="p">,</span><span class="n">age</span><span class="p">)</span> <span class="o">%&gt;%</span> <span class="nf">mutate</span><span class="p">(</span><span class="nf">ifelse</span><span class="p">(</span><span class="n">id</span><span class="o">==</span><span class="nf">lag</span><span class="p">(</span><span class="n">id</span><span class="p">),</span><span class="n">age</span> <span class="o">-</span> <span class="nf">lag</span><span class="p">(</span><span class="n">age</span><span class="p">),</span><span class="m">1</span><span class="p">))</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="missing-data">
<h2>Missing data<a class="headerlink" href="#missing-data" title="Permalink to this headline">¶</a></h2>
<p>By default, the regression model will exclude any observation with missing values on its predictors. Missing values can be treated as a separate category for categorical data. For missing numeric data, imputation is a potential solution. In the example below we replace missing age with an average and add an indicator to the data to flag records that have been imputed.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># find the average age among non-missing values</span>
<span class="nf">summary</span><span class="p">(</span><span class="n">df</span><span class="o">$</span><span class="n">age</span><span class="p">)</span>
<span class="c1"># impute missing age values with the mean age</span>
<span class="n">df</span><span class="o">$</span><span class="n">imputed_age</span> <span class="o">&lt;-</span> <span class="nf">ifelse</span><span class="p">(</span><span class="nf">is.na</span><span class="p">(</span><span class="n">df</span><span class="o">$</span><span class="n">age</span><span class="p">)</span><span class="o">==</span><span class="kc">TRUE</span><span class="p">,</span><span class="nf">round</span><span class="p">(</span><span class="nf">mean</span><span class="p">(</span><span class="n">df</span><span class="o">$</span><span class="n">age</span><span class="p">,</span> <span class="n">na.rm</span><span class="o">=</span><span class="kc">TRUE</span><span class="p">),</span><span class="m">2</span><span class="p">),</span><span class="n">df</span><span class="o">$</span><span class="n">age</span><span class="p">)</span>
<span class="c1"># create missing value indicator for age</span>
<span class="n">df</span><span class="o">$</span><span class="n">missing_age</span> <span class="o">&lt;-</span> <span class="nf">ifelse</span><span class="p">(</span><span class="nf">is.na</span><span class="p">(</span><span class="n">df</span><span class="o">$</span><span class="n">age</span><span class="p">)</span><span class="o">==</span><span class="kc">TRUE</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">0</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="review-exposure-data">
<h2>Review exposure data<a class="headerlink" href="#review-exposure-data" title="Permalink to this headline">¶</a></h2>
<p>The tables and graphs that follow look at:</p>
<ul class="simple">
<li><p>the mix of business over rating factors using some of the selection methods described: These are all consistent with the simulation specification.</p></li>
<li><p>the correlation of ordered numerical rating factors: age and sum assured as well as age and policy year are positively correlated.</p></li>
</ul>
<p>Data might need to be <a class="reference external" href="https://en.wikipedia.org/wiki/Data_transformation_(statistics)">transformed</a> in order to make the data more suitable to the assumptions within the model. Not considered here.</p>
<p>Look at distribution by single rating factors.</p>
<div class="cell tag_remove_input docutils container">
</div>
<div class="section" id="benefit-period-mix">
<h3>Benefit period mix<a class="headerlink" href="#benefit-period-mix" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">%&gt;%</span> <span class="nf">count</span><span class="p">(</span><span class="n">benefit_period</span><span class="p">,</span> <span class="n">wt</span> <span class="o">=</span> <span class="kc">NULL</span><span class="p">,</span> <span class="n">sort</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)</span> <span class="o">%&gt;%</span> 
   <span class="nf">mutate</span><span class="p">(</span><span class="n">freq</span> <span class="o">=</span> <span class="nf">percent</span><span class="p">(</span><span class="nf">round</span><span class="p">(</span><span class="n">n</span> <span class="o">/</span> <span class="nf">sum</span><span class="p">(</span><span class="n">n</span><span class="p">),</span><span class="m">2</span><span class="p">)))</span> <span class="o">%&gt;%</span> 
   <span class="nf">format</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">big.mark</span><span class="o">=</span><span class="s">&quot;,&quot;</span><span class="p">)</span> 
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="waiting-period-mix">
<h3>Waiting period mix<a class="headerlink" href="#waiting-period-mix" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">%&gt;%</span> <span class="nf">count</span><span class="p">(</span><span class="n">waiting_period</span><span class="p">,</span> <span class="n">wt</span> <span class="o">=</span> <span class="kc">NULL</span><span class="p">,</span> <span class="n">sort</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)</span> <span class="o">%&gt;%</span> 
   <span class="nf">mutate</span><span class="p">(</span><span class="n">freq</span> <span class="o">=</span> <span class="nf">percent</span><span class="p">(</span><span class="nf">round</span><span class="p">(</span><span class="n">n</span> <span class="o">/</span> <span class="nf">sum</span><span class="p">(</span><span class="n">n</span><span class="p">),</span><span class="m">2</span><span class="p">)))</span> <span class="o">%&gt;%</span> 
   <span class="nf">format</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">big.mark</span><span class="o">=</span><span class="s">&quot;,&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="occupation-mix">
<h3>Occupation mix<a class="headerlink" href="#occupation-mix" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">%&gt;%</span> <span class="nf">count</span><span class="p">(</span><span class="n">occupation</span><span class="p">,</span> <span class="n">wt</span> <span class="o">=</span> <span class="kc">NULL</span><span class="p">,</span> <span class="n">sort</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)</span> <span class="o">%&gt;%</span> 
   <span class="nf">mutate</span><span class="p">(</span><span class="n">freq</span> <span class="o">=</span> <span class="nf">percent</span><span class="p">(</span><span class="nf">round</span><span class="p">(</span><span class="n">n</span> <span class="o">/</span> <span class="nf">sum</span><span class="p">(</span><span class="n">n</span><span class="p">),</span><span class="m">2</span><span class="p">)))</span> <span class="o">%&gt;%</span> 
   <span class="nf">format</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">big.mark</span><span class="o">=</span><span class="s">&quot;,&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Consider a histogram to show the distribution of numeric data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">hist</span><span class="p">(</span><span class="n">df</span><span class="o">$</span><span class="n">age</span><span class="p">,</span> <span class="n">main</span> <span class="o">=</span> <span class="s">&quot;Histogram of age&quot;</span><span class="p">,</span> <span class="n">xlab</span> <span class="o">=</span> <span class="s">&quot;Age&quot;</span><span class="p">,</span> <span class="n">ylab</span> <span class="o">=</span> <span class="s">&quot;Frequency&quot;</span><span class="p">)</span>
<span class="nf">hist</span><span class="p">(</span><span class="n">df</span><span class="o">$</span><span class="n">sum_assured</span><span class="p">,</span> <span class="n">main</span> <span class="o">=</span> <span class="s">&quot;Histogram of sum assured&quot;</span><span class="p">,</span> <span class="n">xlab</span> <span class="o">=</span> <span class="s">&quot;Sum assured&quot;</span><span class="p">,</span> <span class="n">ylab</span> <span class="o">=</span> <span class="s">&quot;Frequency&quot;</span><span class="p">)</span>
<span class="nf">hist</span><span class="p">(</span><span class="n">df</span><span class="o">$</span><span class="n">policy_year</span><span class="p">,</span> <span class="n">main</span> <span class="o">=</span> <span class="s">&quot;Histogram of policy year&quot;</span><span class="p">,</span> <span class="n">xlab</span> <span class="o">=</span> <span class="s">&quot;Policy year&quot;</span><span class="p">,</span> <span class="n">ylab</span> <span class="o">=</span> <span class="s">&quot;Frequency&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Consider the correlation of ordered numeric explanatory variables.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># correlation of ordered numeric explanatory variables</span>
<span class="c1">#	pairs() gives correlation matrix and plots; test on a random sample from our data</span>
<span class="n">df_sample</span> <span class="o">&lt;-</span> <span class="nf">sample_n</span><span class="p">(</span><span class="n">df</span><span class="p">,</span><span class="m">10000</span><span class="p">,</span><span class="n">replace</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">)</span> 
<span class="n">df_sample</span> <span class="o">%&gt;%</span> <span class="nf">select</span><span class="p">(</span><span class="n">age</span><span class="p">,</span><span class="n">policy_year</span><span class="p">,</span><span class="n">sum_assured</span><span class="p">)</span> <span class="o">%&gt;%</span> <span class="n">pairs</span>
<span class="c1"># or cor() to return just the correlation matrix</span>
<span class="n">cor</span> <span class="o">&lt;-</span><span class="n">df_sample</span> <span class="o">%&gt;%</span> <span class="nf">select</span><span class="p">(</span><span class="n">age</span><span class="p">,</span><span class="n">policy_year</span><span class="p">,</span><span class="n">sum_assured</span><span class="p">)</span> <span class="o">%&gt;%</span> <span class="n">cor</span>
<span class="n">cor</span>
<span class="c1"># corrplot() is an alternative to visualise a correlation matrix</span>
<span class="nf">corrplot</span><span class="p">(</span><span class="n">cor</span><span class="p">,</span> 
  <span class="n">addCoef.col</span> <span class="o">=</span> <span class="s">&quot;black&quot;</span><span class="p">,</span> <span class="c1"># add coefficient of correlation</span>
  <span class="n">method</span><span class="o">=</span><span class="s">&quot;color&quot;</span><span class="p">,</span> 
  <span class="n">sig.level</span> <span class="o">=</span> <span class="m">0.01</span><span class="p">,</span> <span class="n">insig</span> <span class="o">=</span> <span class="s">&quot;blank&quot;</span><span class="p">,</span> 
  <span class="n">tl.col</span><span class="o">=</span><span class="s">&quot;black&quot;</span><span class="p">,</span> <span class="c1"># tl stands for text label</span>
  <span class="n">tl.srt</span><span class="o">=</span><span class="m">45</span>
  <span class="p">)</span> 
</pre></div>
</div>
</div>
</div>
<p>ggpairs() similarly shows correlations for ordered numeric data as well as other summary stats:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1">#ggpairs() similarly shows correlations for ordered numeric data as well as other summary stats</span>
<span class="n">df_sample</span> <span class="o">%&gt;%</span> <span class="nf">select</span><span class="p">(</span><span class="n">age</span><span class="p">,</span><span class="n">policy_year</span><span class="p">,</span><span class="n">sum_assured</span><span class="p">,</span><span class="n">sex</span><span class="p">,</span> <span class="n">smoker</span><span class="p">)</span> <span class="o">%&gt;%</span> 
<span class="nf">ggpairs</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="m">1</span><span class="o">:</span><span class="m">3</span><span class="p">,</span> <span class="nf">aes</span><span class="p">(</span><span class="n">color</span> <span class="o">=</span> <span class="n">sex</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="m">0.5</span><span class="p">),</span>
        <span class="n">upper</span> <span class="o">=</span> <span class="nf">list</span><span class="p">(</span><span class="n">continuous</span> <span class="o">=</span> <span class="nf">wrap</span><span class="p">(</span><span class="s">&quot;cor&quot;</span><span class="p">,</span> <span class="n">size</span> <span class="o">=</span> <span class="m">2.5</span><span class="p">)),</span>
        <span class="n">lower</span> <span class="o">=</span> <span class="nf">list</span><span class="p">(</span><span class="n">continuous</span> <span class="o">=</span> <span class="s">&quot;smooth&quot;</span><span class="p">))</span>

<span class="n">df_sample</span> <span class="o">%&gt;%</span> <span class="nf">select</span><span class="p">(</span><span class="n">age</span><span class="p">,</span><span class="n">policy_year</span><span class="p">,</span><span class="n">sum_assured</span><span class="p">,</span><span class="n">sex</span><span class="p">,</span> <span class="n">smoker</span><span class="p">)</span> <span class="o">%&gt;%</span> 
<span class="nf">ggpairs</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="s">&quot;sum_assured&quot;</span><span class="p">,</span> <span class="s">&quot;smoker&quot;</span><span class="p">),</span> <span class="nf">aes</span><span class="p">(</span><span class="n">color</span> <span class="o">=</span> <span class="n">sex</span><span class="p">,</span> <span class="n">alpha</span> <span class="o">=</span> <span class="m">0.5</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p>Review summary statistics for subsets of data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">head</span><span class="p">(</span><span class="nf">aggregate</span><span class="p">(</span><span class="n">df</span><span class="o">$</span><span class="n">sum_assured</span><span class="o">~</span><span class="n">df</span><span class="o">$</span><span class="n">age</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">,</span><span class="n">mean</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="data-format">
<h2>Data format<a class="headerlink" href="#data-format" title="Permalink to this headline">¶</a></h2>
<p>There are two main formats for structured data - long and wide. For regression, the structure of data informs the model structure. For counts data:</p>
<ul class="simple">
<li><p>the long format corresponds to Bernoulli (claim or no claim for each observation) and allows for predictor variables by observation;</p></li>
<li><p>the wide format correspond to Binomial (count of claims per exposure). Wide format structures can include matrix of successes and failures or a proportion of successes and corresponding weights / number of observations/exposure for each line.</p></li>
</ul>
<p>There are several tidyverse functions that can help with restructuring data, for example, convert data into wide format e.g.separate into a separate column for each value of sex:</p>
<div class="section" id="wide-data-format-example">
<h3>Wide data format example<a class="headerlink" href="#wide-data-format-example" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">head</span><span class="p">(</span><span class="nf">spread</span><span class="p">(</span><span class="n">df_sample</span><span class="p">,</span> <span class="n">sex</span><span class="p">,</span> <span class="n">inc_count_tot</span><span class="p">,</span> <span class="n">fill</span> <span class="o">=</span> <span class="m">0</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">gather()</span></code> converts data into long format; also <code class="docutils literal notranslate"><span class="pre">pivot_longer()</span></code> and <code class="docutils literal notranslate"><span class="pre">pivot_wider()</span></code>.</p>
</div>
</div>
<div class="section" id="visualisation-methods">
<h2>Visualisation methods<a class="headerlink" href="#visualisation-methods" title="Permalink to this headline">¶</a></h2>
<div class="section" id="introduction-to-ggplot">
<h3>Introduction to ggplot<a class="headerlink" href="#introduction-to-ggplot" title="Permalink to this headline">¶</a></h3>
<p>This section sets out some simple visualisation methods using ggplot(). ggplot() Initializes a ggplot object. It can be used to declare the input data frame for a graphic and to specify the set of plot aesthetics intended to be common throughout all subsequent layers unless specifically overridden [&#64;ggplot]. The form of ggplot is:</p>
<p><code class="docutils literal notranslate"><span class="pre">ggplot(data</span> <span class="pre">=</span> <span class="pre">df,</span> <span class="pre">mapping</span> <span class="pre">=</span> <span class="pre">aes(x,y,</span> <span class="pre">other</span> <span class="pre">aesthetics),</span> <span class="pre">...)</span></code></p>
<p>Examples below use ggplot to explore the exposure data.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># data argument passes the data frame to be visualised</span>
<span class="c1"># mapping argument defines a list of aesthetics for the visualisation - all subsequent layers use those unless overridden</span>
<span class="c1"># typically, the dependent variable is mapped onto the the y-axis and the independent variable is mapped onto the x-axis.</span>
<span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">df_sample</span><span class="p">,</span> <span class="n">mapping</span><span class="o">=</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">age</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">sum_assured</span><span class="p">))</span> <span class="o">+</span> <span class="c1"># the &#39;+&#39; adds the layer below</span>
<span class="c1"># add subsequent visualisation layers, e.g. geom_point() for scatterplot</span>
<span class="nf">geom_point</span><span class="p">()</span> <span class="o">+</span>
<span class="c1"># add a layer to change axis labels</span>
<span class="c1"># could add a layer to specify axis limits with ylim() and xlim() </span>
<span class="nf">labs</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s">&quot;Age&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s">&quot;Sum assured&quot;</span><span class="p">,</span> <span class="n">title</span> <span class="o">=</span> <span class="s">&quot;Sum Assured by age&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="layers">
<h3>Layers<a class="headerlink" href="#layers" title="Permalink to this headline">¶</a></h3>
<p>The aesthetics input has a number of different options, for example x and y (axes),	colour,	size,	fill,	labels,	alpha (transparency),	shape,	line type / width. You can change the aesthetics of each layer or default to the base layer. You can change the general look and feel of charts with a themes layer e.g. colour palette (see more in the next section).</p>
<p>You can add more layers to the base plot, for example</p>
<ul class="simple">
<li><p>Geometries (geom_), for example</p>
<ul>
<li><p><a class="reference external" href="https://ggplot2.tidyverse.org/reference/geom_point.html">point</a> - scatterplot,</p></li>
<li><p>line,</p></li>
<li><p>histogram,</p></li>
<li><p>bar/ column,</p></li>
<li><p>boxplot,</p></li>
<li><p>density,</p></li>
<li><p><a class="reference external" href="https://ggplot2.tidyverse.org/reference/geom_jitter.html">jitter</a> - adds random noise to separate points,</p></li>
<li><p><a class="reference external" href="https://ggplot2.tidyverse.org/reference/geom_count.html">count</a> - counts the number of observations at each location, then maps the count to point area,</p></li>
<li><p><a class="reference external" href="https://ggplot2.tidyverse.org/reference/geom_abline.html">abline</a> - adds a reference line - vertical, horizontal or diagonal,</p></li>
<li><p><a class="reference external" href="https://ggplot2.tidyverse.org/reference/geom_segment.html">curve</a> - adds a curved line to the chart between specified points,</p></li>
<li><p>text - add a text layer to label data points.</p></li>
</ul>
</li>
<li><p>Statistics (stat_)</p>
<ul>
<li><p><a class="reference external" href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">smooth</a> (curve fitted to the data),</p></li>
<li><p>bin (e.g. for histogram).</p></li>
</ul>
</li>
</ul>
<p>A note on overlapping points: these can be adjusted for by adding noise and transparency to your points:</p>
<ul class="simple">
<li><p>within an existing geom e.g. geom_point(position=”*”) with options including: identity (default = position is as per data), dodge (dodge overlapping objects side-to-side), jitter (random noise), jitterdodge, and nudge (nudge points a fixed distance) e.g. geom_bar(position = “dodge”) or geom_bar(position=position_dodge(width=0.2)).</p></li>
<li><p>or use geom_* with arguments e.g. geom_jitter(alpha = 0.2, shape=1). Shape choice might help, shape = 1 gives hollow circles.</p></li>
</ul>
<p>Or alternatively count overlapping points with geom_count().</p>
<p>A full list of layers is available <a class="reference external" href="https://ggplot2.tidyverse.org/reference/">here</a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">df_sample</span><span class="p">,</span> <span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">age</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">sum_assured</span><span class="p">))</span> <span class="o">+</span>
<span class="nf">geom_point</span><span class="p">()</span> <span class="o">+</span> 
<span class="c1"># separate overlapping points</span>
<span class="nf">geom_jitter</span><span class="p">(</span><span class="n">alpha</span> <span class="o">=</span> <span class="m">0.2</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="m">0.2</span><span class="p">)</span> <span class="o">+</span>
<span class="c1"># add a smoothing line</span>
<span class="nf">geom_smooth</span><span class="p">(</span><span class="n">method</span> <span class="o">=</span> <span class="s">&quot;glm&quot;</span><span class="p">,</span> <span class="n">se</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">)</span> 
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="themes">
<h3>Themes<a class="headerlink" href="#themes" title="Permalink to this headline">¶</a></h3>
<p>You can add a themes layer to your graph [&#64;ggplot_themes], for example</p>
<ul class="simple">
<li><p>theme_gray()        |Gray background and white grid lines.</p></li>
<li><p>theme_bw()          |White background and gray grid lines.</p></li>
<li><p>theme_linedraw()    |A theme with only black lines of various widths on white backgrounds.</p></li>
<li><p>theme_light()       |A theme similar to theme_linedraw() but with light grey lines and axes, to direct more attention towards the data.</p></li>
<li><p>theme_dark()        |Similar to theme_light() but with a dark background.</p></li>
<li><p>Others              |e.g. theme_minimal() and theme_classic()</p></li>
</ul>
<p>Other packages like ggthemes carry many more options. Example of added themes layer below. See also these examples <a class="reference external" href="https://yutannihilation.github.io/allYourFigureAreBelongToUs/ggthemes/">these examples</a> from ggthemes.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># add an occupation group to the data</span>
<span class="n">df_sample</span> <span class="o">&lt;-</span> <span class="n">df_sample</span> <span class="o">%&gt;%</span> <span class="nf">mutate</span><span class="p">(</span><span class="n">occ_group</span> <span class="o">=</span> <span class="nf">factor</span><span class="p">(</span><span class="nf">case_when</span><span class="p">(</span><span class="n">occupation</span> <span class="o">%in%</span> <span class="nf">c</span><span class="p">(</span><span class="s">&quot;white&quot;</span><span class="p">,</span><span class="s">&quot;prof&quot;</span><span class="p">,</span><span class="s">&quot;sed&quot;</span><span class="p">)</span> <span class="o">~</span> <span class="s">&quot;WC&quot;</span><span class="p">,</span> <span class="kc">TRUE</span> <span class="o">~</span> <span class="s">&quot;BC&quot;</span><span class="p">)))</span>

<span class="c1"># vary colour by occupation</span>
<span class="nf">ggplot</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">df_sample</span><span class="p">,</span> <span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">age</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">sum_assured</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">occ_group</span><span class="p">))</span> <span class="o">+</span>
<span class="c1"># jitter and fit a smoothed line as below</span>
<span class="nf">geom_jitter</span><span class="p">(</span><span class="n">alpha</span> <span class="o">=</span> <span class="m">0.2</span><span class="p">,</span> <span class="n">width</span> <span class="o">=</span> <span class="m">0.2</span><span class="p">)</span> <span class="o">+</span>
<span class="nf">geom_smooth</span><span class="p">(</span><span class="n">method</span> <span class="o">=</span> <span class="s">&quot;glm&quot;</span><span class="p">,</span> <span class="n">se</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">)</span> <span class="o">+</span>
<span class="c1"># add labels</span>
<span class="nf">labs</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s">&quot;Age&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s">&quot;Sum assured&quot;</span><span class="p">,</span> <span class="n">title</span> <span class="o">=</span> <span class="s">&quot;Sum Assured by age&quot;</span><span class="p">)</span> <span class="o">+</span>
<span class="c1"># adding theme and colour palette layers</span>
<span class="nf">theme_pander</span><span class="p">()</span> <span class="o">+</span> <span class="nf">scale_color_gdocs</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="d-visualisations-with-plotly">
<h3>3D visualisations with plotly<a class="headerlink" href="#d-visualisations-with-plotly" title="Permalink to this headline">¶</a></h3>
<p>ggplot does not cater to 3D visualisations, but this can be done through plotly simply.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">plot_base</span> <span class="o">&lt;-</span> <span class="nf">plot_ly</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">df_sample</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span> <span class="o">~</span><span class="n">sum_assured</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span> <span class="o">~</span><span class="n">age</span><span class="p">,</span> <span class="n">y</span><span class="o">=~</span><span class="n">policy_year</span><span class="p">,</span> <span class="n">opacity</span><span class="o">=</span><span class="m">0.6</span><span class="p">)</span> <span class="o">%&gt;%</span>
<span class="nf">add_markers</span><span class="p">(</span><span class="n">color</span> <span class="o">=</span> <span class="o">~</span><span class="n">occ_group</span><span class="p">,</span><span class="n">colors</span><span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="s">&quot;blue&quot;</span><span class="p">,</span> <span class="s">&quot;red&quot;</span><span class="p">),</span> <span class="n">marker</span><span class="o">=</span><span class="nf">list</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="m">2</span><span class="p">))</span> 
<span class="c1"># show graph</span>
<span class="c1"># plot_base</span>

<span class="c1"># show graph in Jupyter notebooks</span>
<span class="nf">embed_notebook</span><span class="p">(</span><span class="n">plot_base</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We can add a modeled outcome to the 3D chart. For detail on the model fit, see later sections.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># to add a plane we need to define the points on the plane. To do that, we first create a grid of x and y values, where x and y are defined as earlier.</span>
<span class="n">x_grid</span> <span class="o">&lt;-</span> <span class="nf">seq</span><span class="p">(</span><span class="n">from</span> <span class="o">=</span> <span class="nf">min</span><span class="p">(</span><span class="n">df_sample</span><span class="o">$</span><span class="n">age</span><span class="p">),</span> <span class="n">to</span> <span class="o">=</span> <span class="nf">max</span><span class="p">(</span><span class="n">df_sample</span><span class="o">$</span><span class="n">age</span><span class="p">),</span> <span class="n">length</span> <span class="o">=</span> <span class="m">50</span><span class="p">)</span>
<span class="n">y_grid</span> <span class="o">&lt;-</span> <span class="nf">seq</span><span class="p">(</span><span class="n">from</span> <span class="o">=</span> <span class="nf">min</span><span class="p">(</span><span class="n">df_sample</span><span class="o">$</span><span class="n">policy_year</span><span class="p">),</span> <span class="n">to</span> <span class="o">=</span> <span class="nf">max</span><span class="p">(</span><span class="n">df_sample</span><span class="o">$</span><span class="n">policy_year</span><span class="p">),</span> <span class="n">length</span> <span class="o">=</span> <span class="m">50</span><span class="p">)</span>

<span class="c1"># create a simple model and extract the coefficient estimates</span>
<span class="n">coeff_est</span> <span class="o">&lt;-</span> <span class="nf">glm</span><span class="p">(</span><span class="n">sum_assured</span> <span class="o">~</span> <span class="n">age</span> <span class="o">+</span> <span class="n">policy_year</span> <span class="o">+</span> <span class="n">occ_group</span><span class="p">,</span><span class="n">family</span><span class="o">=</span><span class="s">&quot;gaussian&quot;</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="n">df_sample</span><span class="p">)</span> <span class="o">%&gt;%</span> <span class="nf">coef</span><span class="p">()</span>
<span class="c1"># extract fitted values for z - here we want fitted values for BC and WC separately, use levels to determine how the model orders the factor occ_group</span>
<span class="n">fitted_values_BC</span> <span class="o">&lt;-</span> <span class="nf">crossing</span><span class="p">(</span><span class="n">y_grid</span><span class="p">,</span> <span class="n">x_grid</span><span class="p">)</span> <span class="o">%&gt;%</span> <span class="nf">mutate</span><span class="p">(</span><span class="n">z_grid</span> <span class="o">=</span> <span class="n">coeff_est</span><span class="p">[</span><span class="m">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">coeff_est</span><span class="p">[</span><span class="m">2</span><span class="p">]</span><span class="o">*</span><span class="n">x_grid</span> <span class="o">+</span> <span class="n">coeff_est</span><span class="p">[</span><span class="m">3</span><span class="p">]</span><span class="o">*</span><span class="n">y_grid</span><span class="p">)</span>
<span class="n">fitted_values_WC</span> <span class="o">&lt;-</span> <span class="nf">crossing</span><span class="p">(</span><span class="n">y_grid</span><span class="p">,</span> <span class="n">x_grid</span><span class="p">)</span> <span class="o">%&gt;%</span> <span class="nf">mutate</span><span class="p">(</span><span class="n">z_grid</span> <span class="o">=</span> <span class="n">coeff_est</span><span class="p">[</span><span class="m">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">coeff_est</span><span class="p">[</span><span class="m">2</span><span class="p">]</span><span class="o">*</span><span class="n">x_grid</span> <span class="o">+</span> <span class="n">coeff_est</span><span class="p">[</span><span class="m">3</span><span class="p">]</span><span class="o">*</span><span class="n">y_grid</span> <span class="o">+</span> <span class="n">coeff_est</span><span class="p">[</span><span class="m">4</span><span class="p">])</span>
<span class="c1"># convert to matrix</span>
<span class="n">z_grid_BC</span> <span class="o">&lt;-</span> <span class="n">fitted_values_BC</span> <span class="o">%&gt;%</span> <span class="nf">pull</span><span class="p">(</span><span class="n">z_grid</span><span class="p">)</span> <span class="o">%&gt;%</span> <span class="nf">matrix</span><span class="p">(</span><span class="n">nrow</span> <span class="o">=</span> <span class="nf">length</span><span class="p">(</span><span class="n">x_grid</span><span class="p">))</span> <span class="o">%&gt;%</span> <span class="nf">t</span><span class="p">()</span>
<span class="n">z_grid_WC</span> <span class="o">&lt;-</span> <span class="n">fitted_values_WC</span> <span class="o">%&gt;%</span> <span class="nf">pull</span><span class="p">(</span><span class="n">z_grid</span><span class="p">)</span> <span class="o">%&gt;%</span> <span class="nf">matrix</span><span class="p">(</span><span class="n">nrow</span> <span class="o">=</span> <span class="nf">length</span><span class="p">(</span><span class="n">x_grid</span><span class="p">))</span> <span class="o">%&gt;%</span> <span class="nf">t</span><span class="p">()</span>

<span class="c1"># define solid colours for the two planes / surfaces</span>
<span class="n">colorscale_BC</span> <span class="o">=</span> <span class="nf">list</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">1</span><span class="p">),</span> <span class="nf">c</span><span class="p">(</span><span class="s">&quot;red&quot;</span><span class="p">,</span> <span class="s">&quot;red&quot;</span><span class="p">))</span>
<span class="n">colorscale_WC</span> <span class="o">=</span> <span class="nf">list</span><span class="p">(</span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">1</span><span class="p">),</span> <span class="nf">c</span><span class="p">(</span><span class="s">&quot;blue&quot;</span><span class="p">,</span> <span class="s">&quot;blue&quot;</span><span class="p">))</span>

<span class="c1"># use plot base created above, add a surface for BC sum assureds and WC sum assureds</span>
<span class="n">plot_base</span> <span class="o">%&gt;%</span>
    <span class="nf">add_surface</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">x_grid</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">y_grid</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">z_grid_BC</span><span class="p">,</span> <span class="n">showscale</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">,</span> <span class="n">colorscale</span><span class="o">=</span><span class="n">colorscale_BC</span><span class="p">)</span> <span class="o">%&gt;%</span>
    <span class="nf">add_surface</span><span class="p">(</span><span class="n">x</span> <span class="o">=</span> <span class="n">x_grid</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">y_grid</span><span class="p">,</span> <span class="n">z</span> <span class="o">=</span> <span class="n">z_grid_WC</span><span class="p">,</span> <span class="n">showscale</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">,</span> <span class="n">colorscale</span><span class="o">=</span><span class="n">colorscale_WC</span><span class="p">)</span> <span class="o">%&gt;%</span> 
    <span class="c1"># filtering sum assured on a narrower range</span>
    <span class="nf">layout</span><span class="p">(</span><span class="n">scene</span> <span class="o">=</span> <span class="nf">list</span><span class="p">(</span><span class="n">zaxis</span> <span class="o">=</span> <span class="nf">list</span><span class="p">(</span><span class="n">range</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">4000</span><span class="p">,</span><span class="m">12000</span><span class="p">))))</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="review-claim-data">
<h2>Review claim data<a class="headerlink" href="#review-claim-data" title="Permalink to this headline">¶</a></h2>
<p>Consider claim vs no claim. should be close to nil overlapping clams. actual claim rate is ~0.003-0.005.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">%&gt;%</span> <span class="nf">select</span><span class="p">(</span><span class="n">inc_count_acc</span><span class="p">,</span><span class="n">inc_count_sick</span><span class="p">)</span> <span class="o">%&gt;%</span> <span class="nf">table</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Plotting claim vs no claim by age and sex:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># use ggplot to plot inc_count_sick by age and sex; using df_sample from earlier</span>
<span class="c1"># clearly all of the points are going to be at 0 or 1 and will overlap at each age -&gt; not useful.</span>
<span class="n">df_sample</span> <span class="o">%&gt;%</span> <span class="nf">ggplot</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">age</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">inc_count_sick</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">sex</span><span class="p">))</span> <span class="o">+</span>
<span class="nf">geom_point</span><span class="p">()</span> <span class="o">+</span>
<span class="nf">theme_pander</span><span class="p">()</span> <span class="o">+</span> <span class="nf">scale_color_gdocs</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>As above but add some random noise around the points to separate them:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">df_sample</span> <span class="o">%&gt;%</span> <span class="nf">ggplot</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">age</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">inc_count_sick</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">sex</span><span class="p">))</span> <span class="o">+</span>
<span class="nf">geom_point</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="nf">position_jitter</span><span class="p">(</span><span class="n">height</span><span class="o">=</span><span class="m">0.1</span><span class="p">))</span> <span class="o">+</span>
<span class="nf">theme_pander</span><span class="p">()</span> <span class="o">+</span> <span class="nf">scale_color_gdocs</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>As above but excluding unknown sex and adding a smoothing line:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># as above but excluding unknown sex (as there are very few claims observed for that group) and adding a smoothing line (setting method as glm)</span>
<span class="c1"># because the claim rate is so low, the smoothed line is very close to zero and so not a particularly useful visualisation.</span>
<span class="n">df_sample</span> <span class="o">%&gt;%</span> <span class="nf">filter</span><span class="p">(</span><span class="n">sex</span> <span class="o">!=</span> <span class="s">&quot;u&quot;</span><span class="p">)</span> <span class="o">%&gt;%</span> <span class="nf">ggplot</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">age</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">inc_count_sick</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">sex</span><span class="p">))</span> <span class="o">+</span>
<span class="nf">geom_point</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="nf">position_jitter</span><span class="p">(</span><span class="n">height</span><span class="o">=</span><span class="m">0.1</span><span class="p">))</span> <span class="o">+</span> 
<span class="nf">geom_smooth</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s">&quot;glm&quot;</span><span class="p">,</span> <span class="n">method.args</span> <span class="o">=</span> <span class="nf">list</span><span class="p">(</span><span class="n">family</span> <span class="o">=</span> <span class="s">&quot;binomial&quot;</span><span class="p">))</span> <span class="o">+</span> <span class="c1"># or list(family = binomial(link=&#39;logit&#39;)</span>
<span class="nf">theme_pander</span><span class="p">()</span> <span class="o">+</span> <span class="nf">scale_color_gdocs</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Looking at total count of claim rather than just sickness shows a slight trend by age:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">df_sample</span> <span class="o">%&gt;%</span> <span class="nf">filter</span><span class="p">(</span><span class="n">sex</span> <span class="o">!=</span> <span class="s">&quot;u&quot;</span><span class="p">)</span> <span class="o">%&gt;%</span> <span class="nf">ggplot</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">age</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">inc_count_tot</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">sex</span><span class="p">))</span> <span class="o">+</span>
<span class="nf">geom_point</span><span class="p">(</span><span class="n">position</span><span class="o">=</span><span class="nf">position_jitter</span><span class="p">(</span><span class="n">height</span><span class="o">=</span><span class="m">0.1</span><span class="p">))</span> <span class="o">+</span> 
<span class="nf">geom_smooth</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s">&quot;glm&quot;</span><span class="p">,</span> <span class="n">method.args</span> <span class="o">=</span> <span class="nf">list</span><span class="p">(</span><span class="n">family</span> <span class="o">=</span> <span class="s">&quot;binomial&quot;</span><span class="p">))</span> <span class="o">+</span> <span class="c1"># or list(family = binomial(link=&#39;logit&#39;)</span>
<span class="nf">theme_pander</span><span class="p">()</span> <span class="o">+</span> <span class="nf">scale_color_gdocs</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Consider claim rate:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># given the actual count of claims is so low, it might be more useful to consider the claim rate</span>
<span class="c1"># use the manipulation methods from earlier to get claim rates by age and sex for accident and sickness; filter out unknown sex and age with low exposure</span>
<span class="c1"># this shows a clear trend by age for males and females</span>
<span class="n">df_grouped</span> <span class="o">&lt;-</span> <span class="n">df</span> <span class="o">%&gt;%</span> <span class="nf">filter</span><span class="p">(</span><span class="n">sex</span> <span class="o">!=</span> <span class="s">&quot;u&quot;</span><span class="p">,</span> <span class="nf">between</span><span class="p">(</span><span class="n">age</span><span class="p">,</span> <span class="m">30</span><span class="p">,</span><span class="m">60</span><span class="p">))</span> <span class="o">%&gt;%</span> <span class="nf">group_by</span><span class="p">(</span><span class="n">age</span><span class="p">,</span><span class="n">sex</span><span class="p">)</span> <span class="o">%&gt;%</span> <span class="nf">summarise</span><span class="p">(</span><span class="n">total_sick</span><span class="o">=</span><span class="nf">sum</span><span class="p">(</span><span class="n">inc_count_sick</span><span class="p">),</span><span class="n">total_acc</span><span class="o">=</span><span class="nf">sum</span><span class="p">(</span><span class="n">inc_count_acc</span><span class="p">),</span> <span class="n">exposure</span><span class="o">=</span><span class="nf">n</span><span class="p">(),</span><span class="n">.groups</span> <span class="o">=</span> <span class="s">&#39;drop&#39;</span><span class="p">)</span> <span class="o">%&gt;%</span> 
<span class="nf">mutate</span><span class="p">(</span><span class="n">sick_rate</span> <span class="o">=</span> <span class="n">total_sick</span><span class="o">/</span><span class="n">exposure</span><span class="p">,</span> <span class="n">acc_rate</span> <span class="o">=</span> <span class="n">total_acc</span><span class="o">/</span><span class="n">exposure</span><span class="p">)</span>
<span class="c1"># used ggplot to graph the results</span>
<span class="n">df_grouped</span> <span class="o">%&gt;%</span>
<span class="nf">ggplot</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">age</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">sick_rate</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">sex</span><span class="p">))</span> <span class="o">+</span>
<span class="nf">geom_point</span><span class="p">()</span> <span class="o">+</span>
<span class="nf">geom_line</span><span class="p">()</span> <span class="o">+</span>
<span class="c1"># add a smoothing line</span>
<span class="nf">geom_smooth</span><span class="p">(</span><span class="n">method</span> <span class="o">=</span> <span class="s">&#39;glm&#39;</span><span class="p">,</span><span class="n">se</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">)</span> <span class="o">+</span>
<span class="c1"># add labels and themes</span>
<span class="nf">labs</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s">&quot;Age&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s">&quot;sick rate&quot;</span><span class="p">,</span> <span class="n">title</span> <span class="o">=</span> <span class="s">&quot;Sickness rate by age&quot;</span><span class="p">)</span> <span class="o">+</span>
<span class="nf">theme_pander</span><span class="p">()</span> <span class="o">+</span> <span class="nf">scale_color_gdocs</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>We can split the graph above into a few tiles to show the rates by other explanatory variables like occupation using <a class="reference external" href="https://ggplot2-book.org/facet.html">facet_wrap</a>; see also “facet_grid”. Can use grid.arrange(plot_1,plot_2, plot_3) from the pdp package to arrange unrelated pplot items.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># as above, but adding occupation</span>
<span class="n">df_grouped</span> <span class="o">&lt;-</span> <span class="n">df</span> <span class="o">%&gt;%</span> <span class="nf">filter</span><span class="p">(</span><span class="n">sex</span> <span class="o">!=</span> <span class="s">&quot;u&quot;</span><span class="p">,</span> <span class="nf">between</span><span class="p">(</span><span class="n">age</span><span class="p">,</span> <span class="m">30</span><span class="p">,</span><span class="m">60</span><span class="p">))</span> <span class="o">%&gt;%</span> <span class="nf">group_by</span><span class="p">(</span><span class="n">age</span><span class="p">,</span><span class="n">sex</span><span class="p">,</span><span class="n">occupation</span><span class="p">)</span> <span class="o">%&gt;%</span> <span class="nf">summarise</span><span class="p">(</span><span class="n">total_sick</span><span class="o">=</span><span class="nf">sum</span><span class="p">(</span><span class="n">inc_count_sick</span><span class="p">),</span><span class="n">total_acc</span><span class="o">=</span><span class="nf">sum</span><span class="p">(</span><span class="n">inc_count_acc</span><span class="p">),</span> <span class="n">exposure</span><span class="o">=</span><span class="nf">n</span><span class="p">(),</span><span class="n">.groups</span> <span class="o">=</span> <span class="s">&#39;drop&#39;</span><span class="p">)</span> <span class="o">%&gt;%</span> <span class="nf">mutate</span><span class="p">(</span><span class="n">sick_rate</span> <span class="o">=</span> <span class="n">total_sick</span><span class="o">/</span><span class="n">exposure</span><span class="p">,</span> <span class="n">acc_rate</span> <span class="o">=</span> <span class="n">total_acc</span><span class="o">/</span><span class="n">exposure</span><span class="p">)</span> 

<span class="n">df_grouped</span> <span class="o">%&gt;%</span>
<span class="c1"># used ggplot to graph the results</span>
<span class="nf">ggplot</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">age</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">sick_rate</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">sex</span><span class="p">))</span> <span class="o">+</span>
<span class="nf">geom_point</span><span class="p">()</span> <span class="o">+</span>
<span class="nf">geom_line</span><span class="p">()</span> <span class="o">+</span>
<span class="c1"># add a smoothing line</span>
<span class="nf">geom_smooth</span><span class="p">(</span><span class="n">method</span> <span class="o">=</span> <span class="s">&#39;glm&#39;</span><span class="p">,</span><span class="n">se</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">)</span> <span class="o">+</span>
<span class="nf">labs</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s">&quot;Age&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s">&quot;sick rate&quot;</span><span class="p">,</span> <span class="n">title</span> <span class="o">=</span> <span class="s">&quot;Sickness rate by age, occupation&quot;</span><span class="p">)</span> <span class="o">+</span>
<span class="nf">theme_pander</span><span class="p">()</span> <span class="o">+</span> <span class="nf">scale_color_gdocs</span><span class="p">()</span> <span class="o">+</span>
<span class="nf">facet_wrap</span><span class="p">(</span><span class="o">~</span><span class="n">occupation</span><span class="p">,</span> <span class="n">ncol</span><span class="o">=</span><span class="m">2</span><span class="p">,</span> <span class="n">nrow</span><span class="o">=</span><span class="m">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Consider sickness rate by occupation:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">df_grouped</span> <span class="o">%&gt;%</span>
<span class="c1"># used ggplot to graph the results</span>
<span class="nf">ggplot</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">occupation</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">sick_rate</span><span class="p">))</span> <span class="o">+</span>
<span class="nf">geom_boxplot</span><span class="p">(</span><span class="n">outlier.colour</span><span class="o">=</span><span class="s">&quot;black&quot;</span><span class="p">,</span> <span class="n">outlier.shape</span><span class="o">=</span><span class="m">16</span><span class="p">,</span> <span class="n">outlier.size</span><span class="o">=</span><span class="m">2</span><span class="p">,</span> <span class="n">notch</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">)</span><span class="o">+</span>
<span class="c1"># add a smoothing line</span>
<span class="nf">labs</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s">&quot;Age&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s">&quot;sick rate&quot;</span><span class="p">,</span> <span class="n">title</span> <span class="o">=</span> <span class="s">&quot;Sickness rate by age, occupation&quot;</span><span class="p">)</span> <span class="o">+</span>
<span class="nf">theme_pander</span><span class="p">()</span> <span class="o">+</span> <span class="nf">scale_color_gdocs</span><span class="p">()</span> <span class="o">+</span>
<span class="nf">facet_wrap</span><span class="p">(</span><span class="o">~</span><span class="n">sex</span><span class="p">,</span> <span class="n">ncol</span><span class="o">=</span><span class="m">2</span><span class="p">,</span> <span class="n">nrow</span><span class="o">=</span><span class="m">3</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="tex2jax_ignore mathjax_ignore section" id="model-selection">
<h1>Model Selection<a class="headerlink" href="#model-selection" title="Permalink to this headline">¶</a></h1>
<p>The sections below provide a refresher on linear and logistic regression; some considerations for insurance data; model selection and testing model fit.</p>
<div class="section" id="splitting-data">
<h2>Splitting data<a class="headerlink" href="#splitting-data" title="Permalink to this headline">¶</a></h2>
<div class="section" id="training-vs-testing-data">
<h3>Training vs testing data<a class="headerlink" href="#training-vs-testing-data" title="Permalink to this headline">¶</a></h3>
<p>Split data into training and testing data sets. We will used 75% of the data for training and the rest for testing.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># Determine the number of rows for training</span>
<span class="nf">nrow</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
<span class="c1"># Create a random sample of row IDs</span>
<span class="n">sample_rows</span> <span class="o">&lt;-</span> <span class="nf">sample</span><span class="p">(</span><span class="nf">nrow</span><span class="p">(</span><span class="n">df</span><span class="p">),</span><span class="m">0.75</span><span class="o">*</span><span class="nf">nrow</span><span class="p">(</span><span class="n">df</span><span class="p">))</span>
<span class="c1"># Create the training dataset</span>
<span class="n">df_train</span> <span class="o">&lt;-</span> <span class="n">df</span><span class="p">[</span><span class="n">sample_rows</span><span class="p">,]</span>
<span class="c1"># Create the test dataset</span>
<span class="n">df_test</span> <span class="o">&lt;-</span> <span class="n">df</span><span class="p">[</span><span class="o">-</span><span class="n">sample_rows</span><span class="p">,]</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="class-imbalance">
<h3>Class imbalance<a class="headerlink" href="#class-imbalance" title="Permalink to this headline">¶</a></h3>
<p>Looking at the random sample we have created, we have a significant imbalance between successes and failures.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">df_train</span> <span class="o">%&gt;%</span> <span class="nf">select</span><span class="p">(</span><span class="n">inc_count_acc</span><span class="p">,</span><span class="n">inc_count_sick</span><span class="p">)</span> <span class="o">%&gt;%</span> <span class="nf">table</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>Generally, “in insurance applications, the prediction of a claim or no claim on an individual policy is rarely the point of statistical modelling … The model is useful provided it explains the variability in claims behaviour, as a function of risk factors. ” [&#64;GLM_Insurance, p108-109] So, as long as we have sufficient actual claims to justify the level of predictor variables fitted to the model we should be ok.</p>
<p>However, in some cases where it is important to correctly predict the binary categorical response variable, we may need to create a sample that has a roughly equal proportion of classes (of successes and failures) and then fit our model to that data. E.g. where we are looking to accurately predict fraud within banking transactions data.</p>
<p>To do that we need to refine our sampling method</p>
<ul class="simple">
<li><p>Down sampling: the majority class is randomly down sampled to be of the same size as the smaller class.</p></li>
<li><p>Up sampling: rows from the minority class (e.g. claim) are repeatedly sampled over and over until they reaches the same size as the majority class (not claim).</p></li>
<li><p>Hybrid sampling: artificial data points are generated and are systematically added around the minority class.</p></li>
</ul>
<p>Showing a method for down sampling below - this is more useful for pure classification models; not that useful for insurance applications.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># Determine the number of rows for training</span>
<span class="n">df_train_ds</span> <span class="o">&lt;-</span> <span class="nf">downSample</span><span class="p">(</span><span class="n">df_train</span><span class="p">,</span><span class="nf">factor</span><span class="p">(</span><span class="n">df_train</span><span class="o">$</span><span class="n">inc_count_sick</span><span class="p">))</span> 
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">df_train_ds</span> <span class="o">%&gt;%</span> <span class="nf">select</span><span class="p">(</span><span class="n">inc_count_sick</span><span class="p">)</span> <span class="o">%&gt;%</span> <span class="nf">table</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="regression">
<h2>Regression<a class="headerlink" href="#regression" title="Permalink to this headline">¶</a></h2>
<div class="section" id="id1">
<h3>Background<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>Linear regression is a method of modelling the relationship between a response (dependent variable) and one or more explanatory variables (predictors; independent variables). For a data set , the relationship between y, the response/ dependent variables and the vector of x’s, the explanatory variables, is linear of the form</p>
<p><span class="math notranslate nohighlight">\(y_{i} = \beta_{0} + \beta_{1}x_{i1} + ... + \beta_{p}x_{ip} + \epsilon_{i} = \mathbf{x}_{i}^t\mathbf{\beta} + \epsilon_{i}\)</span>, <span class="math notranslate nohighlight">\(i = 1,...,n\)</span></p>
<p>Key assumptions</p>
<ul class="simple">
<li><p>linearity - response is some linear combination of regression coefficients and explanatory variables</p></li>
<li><p>constant variance (homoskedastic) - variance of errors does not depend upon explanatory variables</p></li>
<li><p>errors are independent - response variables uncorrelated</p></li>
<li><p>explanatory variables are not perfectly co-linear</p></li>
<li><p>weak exogeneity - predictors treated as fixed / no measurement error.</p></li>
</ul>
</div>
<div class="section" id="linear-vs-logistic-regression">
<h3>Linear vs logistic regression<a class="headerlink" href="#linear-vs-logistic-regression" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Linear: Continuous response outcome i.e. predicting a continuous response / dependent variable using a set of explanatory variables</p></li>
<li><p>Logistic: Binary response outcome - straight line does not fit the data well. The predicted values are always between 0 and 1.</p></li>
</ul>
<p>For logistic regression the log odds are linear. We can transform to odds ratios by taking the exponential of the coefficients or exp(coef(model)) - this shows the relative change to odds of the response variables, where</p>
<ul class="simple">
<li><p>Odds-ratio = 1, the coefficient has no effect.</p></li>
<li><p>Odds-ratio is &lt;1, the coefficient predicts a decreased chance of an event occurring.</p></li>
<li><p>Odds-ratio is &gt;1, the coefficient predicts an increased chance of an event occurring.</p></li>
</ul>
</div>
<div class="section" id="logistic-regression-for-claims-incidence">
<h3>Logistic regression for claims incidence<a class="headerlink" href="#logistic-regression-for-claims-incidence" title="Permalink to this headline">¶</a></h3>
<p>A simple regression model is shown below. Interpreting co-efficients and other output:</p>
<ul class="simple">
<li><p>Intercept - global intercept and reference intercepts for each group (reference intercept: + contract (y~x); or intercept for each group: y~x-1)</p></li>
<li><p>Slopes - other coefficients, estimates linear coefficient for continuous variable</p></li>
</ul>
<p>Other output</p>
<ul class="simple">
<li><p>Pr(&gt;|z|)/ p value is the probability coefficient result you’re seeing happened due to random variation. Commonly a p-value of .05 or less is significant.</p></li>
<li><p>AIC and likelihood tests, useful for model comparison.</p></li>
<li><p>Residuals sections gives summary stats of the model.</p></li>
<li><p>Call gives the form of the model.</p></li>
<li><p>vcov(model) gives the variance-covariance matrix for fitted model (diagonals are variance and off diagonals are covariance - 0 if all variables are orthogonal).</p></li>
<li><p>coef(model) returns the model coefficients.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">model_1</span> <span class="o">&lt;-</span> <span class="nf">glm</span><span class="p">(</span><span class="n">inc_count_sick</span><span class="o">~</span><span class="n">age</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="n">df_train</span><span class="p">,</span><span class="n">family</span><span class="o">=</span><span class="s">&quot;binomial&quot;</span><span class="p">)</span> <span class="c1"># use the default link</span>
<span class="nf">summary</span><span class="p">(</span><span class="n">model_1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Choice of <a class="reference external" href="https://en.wikipedia.org/wiki/Generalized_linear_model">link function</a>: the link function defines the relationship of response variables to mean. It is usually sufficient to use the standard link. Section below shows a model with the link specified (results are the same as the model above).</p>
<div class="cell tag_remove_output docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">model_2</span> <span class="o">&lt;-</span> <span class="nf">glm</span><span class="p">(</span><span class="n">inc_count_sick</span><span class="o">~</span><span class="n">age</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="n">df_train</span><span class="p">,</span><span class="n">family</span><span class="o">=</span><span class="nf">binomial</span><span class="p">(</span><span class="n">link</span><span class="o">=</span><span class="s">&quot;logit&quot;</span><span class="p">))</span> <span class="c1"># specify the link, logit is default for binomial</span>
<span class="nf">summary</span><span class="p">(</span><span class="n">model_2</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Adding more response variables: When deciding on explanatory variables to model, consider the properties of the data (like correlation or colinearity).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">model_3</span> <span class="o">&lt;-</span> <span class="nf">glm</span><span class="p">(</span><span class="n">inc_count_sick</span><span class="o">~</span><span class="n">age</span><span class="o">+</span><span class="n">policy_year</span><span class="o">+</span><span class="n">sex</span><span class="o">+</span><span class="n">waiting_period</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="n">df_train</span><span class="p">,</span><span class="n">family</span><span class="o">=</span><span class="nf">binomial</span><span class="p">(</span><span class="n">link</span><span class="o">=</span><span class="s">&quot;logit&quot;</span><span class="p">))</span> 
<span class="nf">summary</span><span class="p">(</span><span class="n">model_3</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="linear-regression-for-claims-incidence">
<h3>Linear regression for claims incidence<a class="headerlink" href="#linear-regression-for-claims-incidence" title="Permalink to this headline">¶</a></h3>
<p>Choice of response distribution: In the logistic regression example above we considered the Binomial response distribution. Other common count distributions are</p>
<ul class="simple">
<li><p><a class="reference external" href="https://en.wikipedia.org/wiki/Poisson_distribution">Poisson</a> distribution: mean and variance are equal.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">lower</span><span class="o">&lt;-</span><span class="nf">qpois</span><span class="p">(</span><span class="m">0.001</span><span class="p">,</span> <span class="n">lambda</span><span class="o">=</span><span class="m">5</span><span class="p">)</span>
<span class="n">upper</span><span class="o">&lt;-</span><span class="nf">qpois</span><span class="p">(</span><span class="m">0.999</span><span class="p">,</span> <span class="n">lambda</span><span class="o">=</span><span class="m">5</span><span class="p">)</span>
<span class="n">x</span><span class="o">&lt;-</span><span class="nf">seq</span><span class="p">(</span><span class="n">lower</span><span class="p">,</span><span class="n">upper</span><span class="p">,</span><span class="m">1</span><span class="p">)</span>

<span class="nf">data.frame</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="nf">dpois</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">lambda</span><span class="o">=</span><span class="m">5</span><span class="p">))</span> <span class="o">%&gt;%</span> <span class="nf">ggplot</span><span class="p">(</span><span class="n">mapping</span><span class="o">=</span><span class="nf">aes</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">))</span> <span class="o">+</span> <span class="nf">geom_col</span><span class="p">()</span><span class="o">+</span>
<span class="nf">labs</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="kc">NULL</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s">&quot;Density&quot;</span><span class="p">,</span> <span class="n">title</span> <span class="o">=</span> <span class="s">&quot;Density, poisson [dpois(x,lambda=5)]&quot;</span><span class="p">)</span><span class="o">+</span>
<span class="nf">theme_pander</span><span class="p">()</span> <span class="o">+</span> <span class="nf">scale_color_gdocs</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p><a class="reference external" href="https://en.wikipedia.org/wiki/Negative_binomial_distribution">Negative Binomial</a> distribution: can handle Poission overdispersion (where the variance is bigger than expected).</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">lower</span><span class="o">&lt;-</span><span class="nf">qnbinom</span><span class="p">(</span><span class="m">0.001</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="m">2</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="m">10</span><span class="p">)</span>
<span class="n">upper</span><span class="o">&lt;-</span><span class="nf">qnbinom</span><span class="p">(</span><span class="m">0.999</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="m">2</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="m">10</span><span class="p">)</span>
<span class="n">x</span><span class="o">&lt;-</span><span class="nf">seq</span><span class="p">(</span><span class="n">lower</span><span class="p">,</span><span class="n">upper</span><span class="p">,</span><span class="m">1</span><span class="p">)</span>

<span class="nf">data.frame</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="nf">dnbinom</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="m">2</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="m">10</span><span class="p">))</span> <span class="o">%&gt;%</span> <span class="nf">ggplot</span><span class="p">(</span><span class="n">mapping</span><span class="o">=</span><span class="nf">aes</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">))</span> <span class="o">+</span> <span class="nf">geom_col</span><span class="p">()</span><span class="o">+</span>
<span class="nf">labs</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="kc">NULL</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s">&quot;Density&quot;</span><span class="p">,</span> <span class="n">title</span> <span class="o">=</span> <span class="s">&quot;Density, negative binomial [dnbinom(x, size=2, mu=10)]&quot;</span><span class="p">)</span><span class="o">+</span>
<span class="nf">theme_pander</span><span class="p">()</span> <span class="o">+</span> <span class="nf">scale_color_gdocs</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>And amount</p>
<ul class="simple">
<li><p><a class="reference external" href="https://en.wikipedia.org/wiki/Normal_distribution">Normal</a> distribution</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">x</span><span class="o">&lt;-</span><span class="nf">seq</span><span class="p">(</span><span class="m">-3.5</span><span class="p">,</span><span class="m">3.5</span><span class="p">,</span><span class="m">0.1</span><span class="p">)</span>  
<span class="nf">data.frame</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="nf">dnorm</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">mean</span><span class="o">=</span><span class="m">0</span><span class="p">,</span> <span class="n">sd</span><span class="o">=</span><span class="m">1</span><span class="p">))</span> <span class="o">%&gt;%</span> <span class="nf">ggplot</span><span class="p">(</span><span class="n">mapping</span><span class="o">=</span><span class="nf">aes</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">))</span> <span class="o">+</span> <span class="nf">geom_line</span><span class="p">()</span><span class="o">+</span>
<span class="nf">labs</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="kc">NULL</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s">&quot;Density&quot;</span><span class="p">,</span> <span class="n">title</span> <span class="o">=</span> <span class="s">&quot;Density, standard normal [dnorm(x, mean=0, sd=1)]&quot;</span><span class="p">)</span><span class="o">+</span>
<span class="nf">theme_pander</span><span class="p">()</span> <span class="o">+</span> <span class="nf">scale_color_gdocs</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p><a class="reference external" href="https://stat.ethz.ch/R-manual/R-devel/library/stats/html/GammaDist.html">Gamma</a> distribution: allows for a fatter tail.</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">lower</span><span class="o">&lt;-</span><span class="nf">qgamma</span><span class="p">(</span><span class="m">0.001</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="m">5</span><span class="p">,</span> <span class="n">rate</span><span class="o">=</span><span class="m">3</span><span class="p">)</span>
<span class="n">upper</span><span class="o">&lt;-</span><span class="nf">qgamma</span><span class="p">(</span><span class="m">0.999</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="m">5</span><span class="p">,</span> <span class="n">rate</span><span class="o">=</span><span class="m">3</span><span class="p">)</span>
<span class="n">x</span><span class="o">&lt;-</span><span class="nf">seq</span><span class="p">(</span><span class="n">lower</span><span class="p">,</span><span class="n">upper</span><span class="p">,</span><span class="m">0.01</span><span class="p">)</span>

<span class="nf">data.frame</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="nf">dgamma</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="m">5</span><span class="p">,</span> <span class="n">rate</span><span class="o">=</span><span class="m">3</span><span class="p">))</span> <span class="o">%&gt;%</span> <span class="nf">ggplot</span><span class="p">(</span><span class="n">mapping</span><span class="o">=</span><span class="nf">aes</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">y</span><span class="p">,</span><span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="p">))</span> <span class="o">+</span> <span class="nf">geom_line</span><span class="p">()</span><span class="o">+</span>
<span class="nf">labs</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="kc">NULL</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s">&quot;Density&quot;</span><span class="p">,</span> <span class="n">title</span> <span class="o">=</span> <span class="s">&quot;Density, gamma [dgamma(x,shape=5, rate=3)]&quot;</span><span class="p">)</span><span class="o">+</span>
<span class="nf">theme_pander</span><span class="p">()</span> <span class="o">+</span> <span class="nf">scale_color_gdocs</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>An example of an amount model, assuming a normal response distribution</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">amount_model_3</span> <span class="o">&lt;-</span> <span class="nf">glm</span><span class="p">(</span><span class="n">inc_amount_sick</span><span class="o">~</span><span class="n">age</span><span class="o">+</span><span class="n">sex</span><span class="o">+</span><span class="n">waiting_period</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="n">df_train</span><span class="p">)</span> 
<span class="nf">tidy</span><span class="p">(</span><span class="n">amount_model_3</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="un-grouped-data">
<h2>(Un)grouped data<a class="headerlink" href="#un-grouped-data" title="Permalink to this headline">¶</a></h2>
<p>The models above were based upon ungrouped data, but earlier we noted that data are often grouped. In grouping data, some detail is usually lost e.g. we no longer have any true continuous categorical response variables. In this case, the columns relating to actual events (here claims) are a sum of the individual instance; more at &#64;GLM_Insurance, p49, 105.</p>
<p>The example below compares a model of counts by age and sex on the grouped and shows that the derived parameters are materially similar.</p>
<div class="section" id="modeled-result-grouped-data">
<h3>Modeled result - grouped data<a class="headerlink" href="#modeled-result-grouped-data" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># grouped model</span>
<span class="n">model_4</span> <span class="o">&lt;-</span> <span class="nf">glm</span><span class="p">(</span><span class="nf">cbind</span><span class="p">(</span><span class="n">inc_count_sick</span><span class="p">,</span><span class="n">exposure</span><span class="o">-</span><span class="n">inc_count_sick</span><span class="p">)</span><span class="o">~</span><span class="n">age</span><span class="o">+</span><span class="n">sex</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="n">df_grp</span><span class="p">,</span><span class="n">family</span><span class="o">=</span><span class="nf">binomial</span><span class="p">(</span><span class="n">link</span><span class="o">=</span><span class="s">&quot;logit&quot;</span><span class="p">))</span> <span class="c1"># cbind gives a matrix of successes and failures</span>
<span class="c1"># use tidy to visualise the modelled result</span>
<span class="nf">tidy</span><span class="p">(</span><span class="n">model_4</span><span class="p">)</span> 
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="modeled-result-ungrouped-data">
<h3>Modeled result - ungrouped data<a class="headerlink" href="#modeled-result-ungrouped-data" title="Permalink to this headline">¶</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># ungrouped model, coefficients materially similar</span>
<span class="n">model_5</span> <span class="o">&lt;-</span> <span class="nf">glm</span><span class="p">(</span><span class="n">inc_count_sick</span><span class="o">~</span><span class="n">age</span><span class="o">+</span><span class="n">sex</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">,</span><span class="n">family</span><span class="o">=</span><span class="nf">binomial</span><span class="p">(</span><span class="n">link</span><span class="o">=</span><span class="s">&quot;logit&quot;</span><span class="p">))</span> 
<span class="nf">tidy</span><span class="p">(</span><span class="n">model_5</span><span class="p">)</span> 
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="offsets">
<h3>Offsets<a class="headerlink" href="#offsets" title="Permalink to this headline">¶</a></h3>
<p>When the data are grouped, it is important to consider the level of exposure in a given group. This can be achieved with an <a class="reference external" href="https://towardsdatascience.com/offsetting-the-model-logic-to-implementation-7e333bc25798">offset</a> term (&#64;GLM_Insurance, p66-67). This is important in an insurance context where we are often interested in modelling rates of claim.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">df_grp_filtered</span> <span class="o">&lt;-</span> <span class="n">df_grp</span> <span class="o">%&gt;%</span> <span class="nf">filter</span><span class="p">(</span><span class="n">inc_count_tot</span><span class="o">&gt;</span><span class="m">1</span><span class="p">,</span> <span class="n">exposure</span><span class="o">&gt;</span><span class="m">10</span><span class="p">)</span>
<span class="n">model_6</span> <span class="o">&lt;-</span> <span class="nf">glm</span><span class="p">(</span><span class="n">inc_amount_tot</span><span class="o">~</span><span class="n">age</span><span class="o">+</span><span class="n">sex</span><span class="o">+</span><span class="nf">offset</span><span class="p">(</span><span class="n">sum_assured</span><span class="p">),</span><span class="n">data</span><span class="o">=</span><span class="n">df_grp_filtered</span><span class="p">)</span> 
<span class="nf">tidy</span><span class="p">(</span><span class="n">model_6</span><span class="p">)</span>
<span class="n">model_7</span> <span class="o">&lt;-</span> <span class="nf">glm</span><span class="p">(</span><span class="n">inc_amount_tot</span><span class="o">~</span><span class="n">age</span><span class="o">+</span><span class="n">sex</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="n">df_grp_filtered</span><span class="p">)</span> 
<span class="nf">tidy</span><span class="p">(</span><span class="n">model_7</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="actuals-or-ave">
<h2>Actuals or AvE?<a class="headerlink" href="#actuals-or-ave" title="Permalink to this headline">¶</a></h2>
<p>The models we have fitted above are based upon actual claim incidences. We can consider the difference between some expected claim rate (e.g. from a standard table) and the actuals.</p>
<p>Using the grouped data again, we model A/E with a normal response distribution. The model shows that none of the coeffients are significant indicating no material difference to expected, which is consistent with the data as the observations were derived from the expected probabilities initially.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># grouped model</span>
<span class="n">model_8</span> <span class="o">&lt;-</span> <span class="nf">glm</span><span class="p">(</span><span class="n">inc_count_sick</span><span class="o">/</span><span class="n">inc_count_sick_exp</span><span class="o">~</span><span class="n">age</span><span class="o">+</span><span class="n">sex</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="n">df_grp</span><span class="p">)</span> 
<span class="c1"># use tidy to visualise the modelled result</span>
<span class="nf">summary</span><span class="p">(</span><span class="n">model_8</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="stepwise-regression">
<h2>Stepwise regression<a class="headerlink" href="#stepwise-regression" title="Permalink to this headline">¶</a></h2>
<p>This method builds a regression model from a set of candidate predictor variables by entering predictors based on p values, in a stepwise manner until there are no variables left to enter any more. Model may over / under-state the importance of predictors and the direction of stepping (forward or backward) can impact the outcome - so some degree of interpretation is necessary.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># specify a null model with no predictors</span>
<span class="n">null_model_sick</span> <span class="o">&lt;-</span> <span class="nf">glm</span><span class="p">(</span><span class="n">inc_count_sick</span> <span class="o">~</span> <span class="m">1</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">df_train</span><span class="p">,</span> <span class="n">family</span> <span class="o">=</span> <span class="s">&quot;binomial&quot;</span><span class="p">)</span>

<span class="c1"># specify the full model using all of the potential predictors</span>
<span class="n">full_model_sick</span> <span class="o">&lt;-</span> <span class="nf">glm</span><span class="p">(</span><span class="n">inc_count_sick</span> <span class="o">~</span> <span class="n">cal_year</span> <span class="o">+</span> <span class="n">policy_year</span> <span class="o">+</span> <span class="n">sex</span> <span class="o">+</span> <span class="n">smoker</span> <span class="o">+</span> <span class="n">benefit_period</span> <span class="o">+</span> <span class="n">waiting_period</span> <span class="o">+</span> <span class="n">occupation</span> <span class="o">+</span> <span class="nf">poly</span><span class="p">(</span><span class="n">age</span><span class="p">,</span><span class="m">3</span><span class="p">)</span> <span class="o">+</span> <span class="n">sum_assured</span> <span class="o">+</span> <span class="n">policy_year</span><span class="o">*</span><span class="n">age</span> <span class="o">+</span> <span class="n">policy_year</span><span class="o">*</span><span class="n">sum_assured</span><span class="p">,</span> <span class="n">data</span> <span class="o">=</span> <span class="n">df_train</span><span class="p">,</span> <span class="n">family</span> <span class="o">=</span> <span class="s">&quot;binomial&quot;</span><span class="p">)</span>

<span class="c1"># alternatively, glm(y~ . -x1) fits model using all variables excluding x1</span>

<span class="c1"># use a forward stepwise algorithm to build a parsimonious model</span>
<span class="n">step_model_sick</span> <span class="o">&lt;-</span> <span class="nf">step</span><span class="p">(</span><span class="n">null_model_sick</span><span class="p">,</span> <span class="n">scope</span> <span class="o">=</span> <span class="nf">list</span><span class="p">(</span><span class="n">lower</span> <span class="o">=</span> <span class="n">null_model_sick</span><span class="p">,</span> <span class="n">upper</span> <span class="o">=</span> <span class="n">full_model_sick</span><span class="p">),</span> <span class="n">direction</span> <span class="o">=</span> <span class="s">&quot;forward&quot;</span><span class="p">)</span>

<span class="nf">summary</span><span class="p">(</span><span class="n">full_model_sick</span><span class="p">)</span>
<span class="nf">summary</span><span class="p">(</span><span class="n">step_model_sick</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The form of the final step model is glm(formula = inc_count_sick ~ poly(age, 3) + waiting_period + sex + smoker + sum_assured, family = “binomial”, data = df_train) i.e. dropping some of the explanatory variables from the full model.</p>
</div>
<div class="section" id="confidence-intervals">
<h2>Confidence intervals<a class="headerlink" href="#confidence-intervals" title="Permalink to this headline">¶</a></h2>
<p>We can compute the confidence intervals for one or more parameters in a fitted model.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">confint</span><span class="p">(</span><span class="n">step_model_sick</span><span class="p">)</span> <span class="c1"># add second argument specifying which parameters we need a confint for</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="predictions">
<h2>Predictions<a class="headerlink" href="#predictions" title="Permalink to this headline">¶</a></h2>
<p>predict() is a generic function that can be used to predict results from various model forms. The function takes the form below. For logistic regression, setting prediction type to response produces a probability rather than log odds (which are difficult to interpret).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># predictions</span>
<span class="n">pred_inc_count_sick</span> <span class="o">&lt;-</span> <span class="nf">as.data.frame</span><span class="p">(</span>
  <span class="nf">predict</span><span class="p">(</span><span class="n">step_model_sick</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span> <span class="n">df_train</span><span class="p">,</span> <span class="c1"># model and data</span>
  <span class="n">type</span><span class="o">=</span><span class="s">&quot;response&quot;</span><span class="p">,</span> <span class="c1"># or terms for coefficients</span>
  <span class="n">se.fit</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">,</span> <span class="c1"># default is false</span>
  <span class="n">interval</span> <span class="o">=</span> <span class="s">&quot;confidence&quot;</span><span class="p">,</span> <span class="c1">#default &quot;none&quot;, also &quot;prediction&quot;</span>
  <span class="n">level</span> <span class="o">=</span> <span class="m">0.95</span>
  <span class="c1"># ...</span>
  <span class="p">)</span>
<span class="p">)</span>

<span class="c1"># add back to data</span>
<span class="nf">ifrm</span><span class="p">(</span><span class="s">&quot;df_train_pred&quot;</span><span class="p">)</span>
<span class="n">pred_inc_count_sick</span> <span class="o">&lt;-</span> <span class="nf">rename</span><span class="p">(</span><span class="n">pred_inc_count_sick</span><span class="p">,</span><span class="n">pred_rate_inc_count_sick</span><span class="o">=</span><span class="n">fit</span><span class="p">,</span><span class="n">se_rate_inc_count_sick</span><span class="o">=</span><span class="n">se.fit</span><span class="p">)</span>
<span class="n">df_train_pred</span> <span class="o">&lt;-</span> <span class="nf">cbind</span><span class="p">(</span><span class="n">df_train</span><span class="p">,</span><span class="n">pred_inc_count_sick</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We can plot the results by age and sex against the crude rates from earlier:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># from earlier, summarise data by age and sex</span>
<span class="n">df_train_pred</span> <span class="o">%&gt;%</span> <span class="nf">filter</span><span class="p">(</span><span class="n">sex</span> <span class="o">!=</span> <span class="s">&quot;u&quot;</span><span class="p">,</span> <span class="nf">between</span><span class="p">(</span><span class="n">age</span><span class="p">,</span> <span class="m">30</span><span class="p">,</span><span class="m">60</span><span class="p">))</span> <span class="o">%&gt;%</span> <span class="nf">group_by</span><span class="p">(</span><span class="n">age</span><span class="p">,</span><span class="n">sex</span><span class="p">)</span> <span class="o">%&gt;%</span> 
<span class="nf">summarise</span><span class="p">(</span><span class="n">total_sick</span><span class="o">=</span><span class="nf">sum</span><span class="p">(</span><span class="n">inc_count_sick</span><span class="p">),</span><span class="n">total_acc</span><span class="o">=</span><span class="nf">sum</span><span class="p">(</span><span class="n">inc_count_acc</span><span class="p">),</span> <span class="n">pred_total_sick</span><span class="o">=</span><span class="nf">sum</span><span class="p">(</span><span class="n">pred_rate_inc_count_sick</span><span class="p">),</span><span class="n">exposure</span><span class="o">=</span><span class="nf">n</span><span class="p">(),</span><span class="n">.groups</span> <span class="o">=</span> <span class="s">&#39;drop&#39;</span><span class="p">)</span> <span class="o">%&gt;%</span> 
<span class="nf">mutate</span><span class="p">(</span><span class="n">sick_rate</span> <span class="o">=</span> <span class="n">total_sick</span><span class="o">/</span><span class="n">exposure</span><span class="p">,</span><span class="n">pred_sick_rate</span> <span class="o">=</span> <span class="n">pred_total_sick</span><span class="o">/</span><span class="n">exposure</span><span class="p">,</span> <span class="n">acc_rate</span> <span class="o">=</span> <span class="n">total_acc</span><span class="o">/</span><span class="n">exposure</span><span class="p">)</span> <span class="o">%&gt;%</span>
<span class="c1"># used ggplot to graph the results</span>
<span class="nf">ggplot</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">age</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">sick_rate</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">sex</span><span class="p">))</span> <span class="o">+</span>
<span class="c1"># ylim(0,1) +</span>
<span class="nf">geom_point</span><span class="p">()</span> <span class="o">+</span>
<span class="c1"># add a modeled line</span>
<span class="nf">geom_line</span><span class="p">(</span><span class="nf">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">age</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">pred_sick_rate</span><span class="p">))</span> <span class="o">+</span>
<span class="nf">theme_pander</span><span class="p">()</span> <span class="o">+</span> <span class="nf">scale_color_gdocs</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="out-of-sample-predictions">
<h3>Out of sample predictions<a class="headerlink" href="#out-of-sample-predictions" title="Permalink to this headline">¶</a></h3>
<p>Earlier we split the data into “training” data used to create the model and “test” data which we intended to use for performance validation. Adding predictions to test data below.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># predictions</span>
<span class="n">pred_inc_count_sick</span> <span class="o">&lt;-</span> <span class="nf">as.data.frame</span><span class="p">(</span>
  <span class="nf">predict</span><span class="p">(</span><span class="n">step_model_sick</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span> <span class="n">df_test</span><span class="p">,</span> <span class="c1"># test data</span>
  <span class="n">type</span><span class="o">=</span><span class="s">&quot;response&quot;</span><span class="p">,</span>
  <span class="n">se.fit</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">,</span> 
  <span class="n">interval</span> <span class="o">=</span> <span class="s">&quot;confidence&quot;</span><span class="p">,</span>
  <span class="n">level</span> <span class="o">=</span> <span class="m">0.95</span>
  <span class="c1"># ...</span>
  <span class="p">)</span>
<span class="p">)</span>

<span class="c1"># add back to data</span>
<span class="nf">ifrm</span><span class="p">(</span><span class="s">&quot;df_test_pred&quot;</span><span class="p">)</span>
<span class="n">pred_inc_count_sick</span> <span class="o">&lt;-</span> <span class="nf">rename</span><span class="p">(</span><span class="n">pred_inc_count_sick</span><span class="p">,</span><span class="n">pred_rate_inc_count_sick</span><span class="o">=</span><span class="n">fit</span><span class="p">,</span><span class="n">se_rate_inc_count_sick</span><span class="o">=</span><span class="n">se.fit</span><span class="p">)</span>
<span class="n">df_test_pred</span> <span class="o">&lt;-</span> <span class="nf">cbind</span><span class="p">(</span><span class="n">df_test</span><span class="p">,</span><span class="n">pred_inc_count_sick</span><span class="p">)</span>

<span class="c1"># summary stats for prediction</span>
<span class="nf">hist</span><span class="p">(</span><span class="n">df_test_pred</span><span class="o">$</span><span class="n">pred_rate_inc_count_sick</span><span class="p">,</span><span class="n">main</span> <span class="o">=</span> <span class="s">&quot;Histogram of predicted sickness rate&quot;</span><span class="p">,</span><span class="n">xlab</span> <span class="o">=</span> <span class="s">&quot;Probability of claim&quot;</span><span class="p">)</span>
<span class="nf">summary</span><span class="p">(</span><span class="n">df_test_pred</span><span class="o">$</span><span class="n">pred_rate_inc_count_sick</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>To translate the predicted probabilities into a vector of claim/no-claim for each policy we could define a claim as occurring if modelled / predicted probability of claim is greater than some threshold value. More on this later under evaluation techniques.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># add binary prediction based upon a threshold probability</span>
<span class="n">df_test_pred</span><span class="o">$</span><span class="n">pred_inc_count_sick</span> <span class="o">&lt;-</span> <span class="nf">ifelse</span><span class="p">(</span><span class="n">df_test_pred</span><span class="o">$</span><span class="n">pred_rate_inc_count_sick</span><span class="o">&gt;</span><span class="m">0.003</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="m">0</span><span class="p">)</span> <span class="c1"># example threshold is ~3rd quartile probability of claim. for balanced data this should be closer to 0.5.</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="tex2jax_ignore mathjax_ignore section" id="evaluation">
<h1>Evaluation<a class="headerlink" href="#evaluation" title="Permalink to this headline">¶</a></h1>
<div class="section" id="techniques">
<h2>Techniques<a class="headerlink" href="#techniques" title="Permalink to this headline">¶</a></h2>
<div class="section" id="aic">
<h3>AIC<a class="headerlink" href="#aic" title="Permalink to this headline">¶</a></h3>
<p>For least squares regression the <span class="math notranslate nohighlight">\(R^{2}\)</span> statistic (<a class="reference external" href="https://en.wikipedia.org/wiki/Coefficient_of_determination">coefficient of determination</a>) measures the proportion of variance in the dependent variable that can be explained by the independent variables. Adjusted <span class="math notranslate nohighlight">\(R^{2}\)</span>, adjusts for the number of predictors in the model. The adjusted <span class="math notranslate nohighlight">\(R^{2}\)</span> increases when the new predictor improves the model more than would be expected by chance. The glm function uses a maximum likelihood estimator which does not minimize the squared error.</p>
<p>AIC stands for <a class="reference external" href="https://en.wikipedia.org/wiki/Akaike_information_criterion">Akaike Information Criteria</a>. <span class="math notranslate nohighlight">\(AIC = -2l+2p\)</span> where <span class="math notranslate nohighlight">\(l\)</span> is the log likelihood and <span class="math notranslate nohighlight">\(p\)</span> are the number of parameters. It is analogous to adjusted <span class="math notranslate nohighlight">\(R^{2}\)</span> and is the measure of fit which penalizes model for the number of independent variables. We prefer a model with a lower AIC value.</p>
<div class="cell tag_remove_input docutils container">
</div>
<p>The results below show the AIC for model 3 is lower than model 1 and that the final step model has the lowest AIC of those evaluated (preferred).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">AIC</span><span class="p">(</span><span class="n">model_1</span><span class="p">)</span>
<span class="nf">AIC</span><span class="p">(</span><span class="n">model_3</span><span class="p">)</span>
<span class="nf">stepAIC</span><span class="p">(</span><span class="n">step_model_sick</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="anova">
<h3>Anova<a class="headerlink" href="#anova" title="Permalink to this headline">¶</a></h3>
<p>An anova comparison below between model_3 and the step model using a Chi-squared test shows a small p value for the stepped model - indicating that the model is an improvement. F-test can be used on continuous response models.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">anova</span><span class="p">(</span><span class="n">model_3</span><span class="p">,</span><span class="n">step_model_sick</span><span class="p">,</span> <span class="n">test</span><span class="o">=</span><span class="s">&quot;Chisq&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="likelihood-ratio-test">
<h3>Likelihood ratio test<a class="headerlink" href="#likelihood-ratio-test" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference external" href="https://en.wikipedia.org/wiki/Likelihood-ratio_test">likelihood ratio test</a> compares two models based upon log likelihoods; more at &#64;GLM_Insurance, p74.</p>
<p>The test below concludes that the step model is more accurate than the less complex model.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">lrtest</span><span class="p">(</span><span class="n">model_3</span><span class="p">,</span><span class="n">step_model_sick</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="other-tests">
<h3>Other tests<a class="headerlink" href="#other-tests" title="Permalink to this headline">¶</a></h3>
<p>Other validations tests could be considered like the <a class="reference external" href="https://en.wikipedia.org/wiki/Wald_test">Wald test</a>, <a class="reference external" href="https://en.wikipedia.org/wiki/Score_test">Score test</a>; see &#64;GLM_Insurance, p74-77.</p>
</div>
</div>
<div class="section" id="residual-checks">
<h2>Residual checks<a class="headerlink" href="#residual-checks" title="Permalink to this headline">¶</a></h2>
<p>Residuals / errors are the observed less fitted values. Traditional residual plots (shown below) are usually a good starting point (we expect to see no trend in the plot of residuals vs fitted values), but are not as informative for logistic regression or for data with a low probability outcome.</p>
<div class="section" id="standard-model-plots">
<h3>Standard model plots<a class="headerlink" href="#standard-model-plots" title="Permalink to this headline">¶</a></h3>
<p>Plots, linear regression example:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">par</span><span class="p">(</span><span class="n">mfrow</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">2</span><span class="p">,</span> <span class="m">2</span><span class="p">))</span>
<span class="nf">plot</span><span class="p">(</span><span class="n">amount_model_3</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Logistic regression example:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">par</span><span class="p">(</span><span class="n">mfrow</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">2</span><span class="p">,</span> <span class="m">2</span><span class="p">))</span>
<span class="nf">plot</span><span class="p">(</span><span class="n">step_model_sick</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="alternatives">
<h3>Alternatives<a class="headerlink" href="#alternatives" title="Permalink to this headline">¶</a></h3>
<p>For logistic regression we can try other tools to test the residuals against the model assumptions. GLMs assume that the residuals / errors are normally distributed. Plotting the density of the residuals gives us:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">hist</span><span class="p">(</span><span class="nf">rstandard</span><span class="p">(</span><span class="n">step_model_sick</span><span class="p">),</span><span class="n">breaks</span><span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="nf">seq</span><span class="p">(</span><span class="m">-1</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="n">by</span><span class="o">=</span><span class="m">0.001</span><span class="p">),</span><span class="nf">seq</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="m">5</span><span class="p">,</span> <span class="n">by</span><span class="o">=</span><span class="m">1</span><span class="p">)),</span><span class="n">freq</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">,</span><span class="n">main</span> <span class="o">=</span> <span class="s">&quot;Histogram of residuals&quot;</span><span class="p">,</span><span class="n">xlab</span> <span class="o">=</span> <span class="s">&quot;Residuals&quot;</span><span class="p">)</span>
<span class="nf">curve</span><span class="p">(</span><span class="n">dnorm</span><span class="p">,</span> <span class="n">add</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Focusing the x axis range:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">hist</span><span class="p">(</span><span class="nf">rstandard</span><span class="p">(</span><span class="n">step_model_sick</span><span class="p">),</span><span class="n">breaks</span><span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="nf">seq</span><span class="p">(</span><span class="m">-1</span><span class="p">,</span><span class="m">1</span><span class="p">,</span><span class="n">by</span><span class="o">=</span><span class="m">0.001</span><span class="p">),</span><span class="nf">seq</span><span class="p">(</span><span class="m">2</span><span class="p">,</span><span class="m">5</span><span class="p">,</span> <span class="n">by</span><span class="o">=</span><span class="m">1</span><span class="p">)),</span> <span class="n">xlim</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">-0.5</span><span class="p">,</span><span class="m">0.5</span><span class="p">),</span><span class="n">freq</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">,</span><span class="n">main</span> <span class="o">=</span> <span class="s">&quot;Histogram of residuals&quot;</span><span class="p">,</span><span class="n">xlab</span> <span class="o">=</span> <span class="s">&quot;Residuals&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>A binned residual plot divides data into bins based upon their fitted values, showing the average residuals vs fitted value for each bin [&#64;stats_notes]:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="c1"># from the arm package</span>
<span class="nf">binnedplot</span><span class="p">(</span><span class="nf">fitted</span><span class="p">(</span><span class="n">step_model_sick</span><span class="p">),</span> 
           <span class="nf">residuals</span><span class="p">(</span><span class="n">step_model_sick</span><span class="p">,</span> <span class="n">type</span> <span class="o">=</span> <span class="s">&quot;response&quot;</span><span class="p">),</span> 
           <span class="n">nclass</span> <span class="o">=</span> <span class="m">50</span><span class="p">,</span> 
           <span class="n">xlab</span> <span class="o">=</span> <span class="s">&quot;Expected Values&quot;</span><span class="p">,</span> 
           <span class="n">ylab</span> <span class="o">=</span> <span class="s">&quot;Average residual&quot;</span><span class="p">,</span> 
           <span class="n">main</span> <span class="o">=</span> <span class="s">&quot;Binned residual plot&quot;</span><span class="p">,</span> 
           <span class="n">cex.pts</span> <span class="o">=</span> <span class="m">0.8</span><span class="p">,</span> 
           <span class="n">col.pts</span> <span class="o">=</span> <span class="m">1</span><span class="p">,</span> 
           <span class="n">col.int</span> <span class="o">=</span> <span class="s">&quot;gray&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Grey lines are 2 se bands (~95%). Apart from a few outliers, most of the residuals are within those bands.</p>
</div>
<div class="section" id="p-p-plots">
<h3>P-P plots<a class="headerlink" href="#p-p-plots" title="Permalink to this headline">¶</a></h3>
<p>The P-P (probability–probability) plot is a visualization that plots CDFs of the two distributions (empirical and theoretical) against each other, an unrelated dummy example below. It can be used to assess the residuals for normality.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">x</span> <span class="o">&lt;-</span> <span class="nf">rnorm</span><span class="p">(</span><span class="m">100</span><span class="p">)</span>
<span class="n">probDist</span> <span class="o">&lt;-</span> <span class="nf">pnorm</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<span class="c1">#create PP plot</span>
<span class="nf">plot</span><span class="p">(</span><span class="nf">ppoints</span><span class="p">(</span><span class="nf">length</span><span class="p">(</span><span class="n">x</span><span class="p">)),</span> <span class="nf">sort</span><span class="p">(</span><span class="n">probDist</span><span class="p">),</span> <span class="n">main</span> <span class="o">=</span> <span class="s">&quot;PP Plot&quot;</span><span class="p">,</span> <span class="n">xlab</span> <span class="o">=</span> <span class="s">&quot;Observed Probability&quot;</span><span class="p">,</span> <span class="n">ylab</span> <span class="o">=</span> <span class="s">&quot;Expected Probability&quot;</span><span class="p">)</span>
<span class="c1">#add diagonal line</span>
<span class="nf">abline</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="id2">
<h3>Other tests<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="https://search.r-project.org/CRAN/refmans/msme/html/P__disp.html">Pearson dispersion test</a>: This function calculates Pearson Chi2 statistic and the Pearson-based dipersion statistic. Values of the dispersion greater than 1 indicate model overdispersion. Values under 1 indicate under-dispersion.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">print</span><span class="p">(</span><span class="nf">P__disp</span><span class="p">(</span><span class="n">step_model_sick</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="section" id="confusion-matrix">
<h2>Confusion matrix<a class="headerlink" href="#confusion-matrix" title="Permalink to this headline">¶</a></h2>
<p>With a binary prediction from the model loaded within the dataframe (defined earlier), we can compare this to the actual outcomes to determine the validity of the model. In this comparison, the true positive rate is called the Sensitivity. The inverse of the false-positive rate is called the Specificity.</p>
<ul class="simple">
<li><p>Sensitivity = TruePositive / (TruePositive + FalseNegative)</p></li>
<li><p>Specificity = TrueNegative / (FalsePositive + TrueNegative)</p></li>
</ul>
<p>Where:</p>
<ul class="simple">
<li><p>Sensitivity = True Positive Rate</p></li>
<li><p>Specificity = 1 – False Positive Rate</p></li>
</ul>
<p>A perfect classification model could have Sensitivity and Specificity close to 1. However, we noted earlier, in insurance applications we are not often interested in in an accurate prediction as to whether a given policy gives rise to a claim. Rather we are interested in understanding the claim rates and how they are explained by the response variables / risk factors [&#64;GLM_Insurance, p108-109].</p>
<p>A confusion matrix is a tabular representation of Observed vs Predicted values. It helps to quantify the efficiency (or accuracy) of the model.</p>
<div class="cell tag_remove_input docutils container">
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="n">confusion_matrix</span> <span class="o">&lt;-</span> <span class="n">df_test_pred</span> <span class="o">%&gt;%</span> <span class="nf">select</span><span class="p">(</span><span class="n">inc_count_sick</span><span class="p">,</span><span class="n">pred_inc_count_sick</span><span class="p">)</span> <span class="o">%&gt;%</span> <span class="nf">table</span><span class="p">()</span>
<span class="n">confusion_matrix</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">cat</span><span class="p">(</span><span class="s">&quot;Accuracy Rate =&quot;</span><span class="p">,(</span><span class="n">confusion_matrix</span><span class="p">[</span><span class="m">1</span><span class="p">,</span><span class="m">1</span><span class="p">]</span><span class="o">+</span><span class="n">confusion_matrix</span><span class="p">[</span><span class="m">2</span><span class="p">,</span><span class="m">2</span><span class="p">])</span><span class="o">/</span><span class="nf">sum</span><span class="p">(</span><span class="n">confusion_matrix</span><span class="p">[]),</span>
<span class="s">&quot;; Missclasification Rate =&quot;</span><span class="p">,(</span><span class="n">confusion_matrix</span><span class="p">[</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">]</span><span class="o">+</span><span class="n">confusion_matrix</span><span class="p">[</span><span class="m">2</span><span class="p">,</span><span class="m">1</span><span class="p">])</span><span class="o">/</span><span class="nf">sum</span><span class="p">(</span><span class="n">confusion_matrix</span><span class="p">[]),</span>
<span class="s">&quot;; True Positive Rate/Sensitivity  =&quot;</span><span class="p">,</span><span class="n">confusion_matrix</span><span class="p">[</span><span class="m">2</span><span class="p">,</span><span class="m">2</span><span class="p">]</span><span class="o">/</span><span class="nf">sum</span><span class="p">(</span><span class="n">confusion_matrix</span><span class="p">[</span><span class="m">2</span><span class="p">,]),</span>
<span class="s">&quot;; False Positive Rate =&quot;</span><span class="p">,</span><span class="n">confusion_matrix</span><span class="p">[</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">]</span><span class="o">/</span><span class="nf">sum</span><span class="p">(</span><span class="n">confusion_matrix</span><span class="p">[</span><span class="m">1</span><span class="p">,]),</span>
<span class="s">&quot;; Specificity =&quot;</span><span class="p">,</span><span class="m">1</span><span class="o">-</span><span class="n">confusion_matrix</span><span class="p">[</span><span class="m">1</span><span class="p">,</span><span class="m">2</span><span class="p">]</span><span class="o">/</span><span class="nf">sum</span><span class="p">(</span><span class="n">confusion_matrix</span><span class="p">[</span><span class="m">1</span><span class="p">,]))</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="roc-auc">
<h2>ROC / AUC<a class="headerlink" href="#roc-auc" title="Permalink to this headline">¶</a></h2>
<p>The ROC (Receiver Operating Characteristic) curve is a graph with:</p>
<ul class="simple">
<li><p>The x-axis showing the False Positive Rate</p></li>
<li><p>The y-axis showing the True Positive Rate</p></li>
</ul>
<p>ROC curves start at 0 on the x and y axis and rise to 1. The faster the curve reaches a True Positive Rate of 1, the better the curve generally. A model on the diagonal is only showing a 50/50 chance of correctly guessing the probability of claim.  Area under an ROC curve (AUC) is a measure of the usefulness of a model in general, where a greater area means more useful. AUC is a tool for comparing models (generally, the closer the AUC is to 1, the better, but there are some cases where AUC can be misleading; AUC = 0.5 is a model on the diagonal).</p>
<p>In our binary model, the AUC is not much better than 0.5, indicating a very weak predictive ability. It isn’t hugely surprising that our model is not very effective at predicting individual claims. As noted earlier, for insurance applications, we are usually more concerned with predicting the claim rate and how it varies by predictors like age and sex [&#64;GLM_Insurance, p108-109].</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-r notranslate"><div class="highlight"><pre><span></span><span class="nf">par</span><span class="p">(</span><span class="n">mfrow</span> <span class="o">=</span> <span class="nf">c</span><span class="p">(</span><span class="m">1</span><span class="p">,</span><span class="m">1</span><span class="p">))</span>
<span class="n">roc</span> <span class="o">=</span> <span class="nf">roc</span><span class="p">(</span><span class="n">df_test_pred</span><span class="o">$</span><span class="n">inc_count_sick</span><span class="p">,</span> <span class="n">df_test_pred</span><span class="o">$</span><span class="n">pred_rate_inc_count_sick</span><span class="p">,</span> <span class="n">plot</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">,</span> <span class="n">print.auc</span> <span class="o">=</span> <span class="kc">TRUE</span><span class="p">)</span>
<span class="nf">as.numeric</span><span class="p">(</span><span class="n">roc</span><span class="o">$</span><span class="n">auc</span><span class="p">)</span>
<span class="nf">coords</span><span class="p">(</span><span class="n">roc</span><span class="p">,</span> <span class="s">&quot;best&quot;</span><span class="p">,</span> <span class="n">ret</span> <span class="o">=</span> <span class="s">&quot;threshold&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</div>
</div>
<div class="tex2jax_ignore mathjax_ignore section" id="references">
<h1>References<a class="headerlink" href="#references" title="Permalink to this headline">¶</a></h1>
<p>Ian Welch. 2020. “Joint Study Reveals Large Rise in Life Insurance Claims Costs.” <a class="reference external" href="https://home.kpmg/au/en/home/media/press-releases/2020/06/joint-study-reveals-large-rise-life-insurance-claims-costs-22-june-2020.html">https://home.kpmg/au/en/home/media/press-releases/2020/06/joint-study-reveals-large-rise-life-insurance-claims-costs-22-june-2020.html</a>.</p>
<p>James Louw. 2012. “Disability Income ProductInnovation in Australia.” Australia: Gen Re. <a class="reference external" href="http://www.actuaries.org/HongKong2012/Presentations/WBR5_Louw.pdf">http://www.actuaries.org/HongKong2012/Presentations/WBR5_Louw.pdf</a>.</p>
<p>Jeff Webb. 2017. “Statistics and Predictive Analytics.” <a class="reference external" href="https://bookdown.org/jefftemplewebb/IS-6489/logistic-regression.html#assessing-logistic-model-fit">https://bookdown.org/jefftemplewebb/IS-6489/logistic-regression.html#assessing-logistic-model-fit</a>.</p>
<p>Piet de Jong, Gillian Z. Heller. 2008. Generalised Linear Models for Insurance Data. Cambridge University Press. <a class="reference external" href="https://ggplot2.tidyverse.org/reference/ggtheme.html">https://ggplot2.tidyverse.org/reference/ggtheme.html</a>.</p>
<p>pkgdown. n.d.a. “Create a New Ggplot.” <a class="reference external" href="https://ggplot2.tidyverse.org/reference/ggplot.html">https://ggplot2.tidyverse.org/reference/ggplot.html</a>.
———. n.d.b. “Ggplot Themes.” <a class="reference external" href="https://ggplot2.tidyverse.org/reference/ggtheme.html">https://ggplot2.tidyverse.org/reference/ggtheme.html</a>.</p>
<p>SOA. 2019. “Analysis of Claim Incidence Experience from 2006 to 2014.” USA: SOA. <a class="reference external" href="https://www.soa.org/resources/experience-studies/2019/claim-incidence-report/">https://www.soa.org/resources/experience-studies/2019/claim-incidence-report/</a>.</p>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "ActuariesInstitute/cookbook",
            ref: "main",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "r"
        },
        kernelOptions: {
            kernelName: "ir",
            path: "./docs"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'ir'</script>

              </div>
              
            
                <!-- Previous / next buttons -->
<div class='prev-next-area'> 
    <a class='left-prev' id="prev-link" href="py_shap_values.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Py: Explainable Models with SHAP</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="life_stats.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">R: Life Industry Stats in Tableau and R</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            
        </div>
    </div>
    <footer class="footer">
  <p>
    
      By YDAWG, DAPC, YAC and other contributors.<br/>
    
      <div class="extra_footer">
         The Actuaries' Analytical Cookbook is a series of data and analytics recipes to help actuaries quickly get started with a new project.   This site is intended to be a resource to actuaries in both data science and traditional fields.  Opinions expressed in this publication are the opinions of contributors and do not necessarily represent those of either the Institute of Actuaries of Australia (the ‘Institute’), its members, directors, officers, employees, agents, or that of the employers of the contributors. <br>© Institute of Actuaries of Australia and Contributors 2021. All rights reserved.
      </div>
  </p>
</footer>
</main>


      </div>
    </div>
  
  <script src="../_static/js/index.be7d3bbb2ef33a8344ce.js"></script>

  </body>
</html>